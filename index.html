

<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>الکوثر – نماز و تلاوت</title>
  <style>
    :root { --bg:#0b3d2e; --accent:#a3d9c9; --accent-2:#dff3ed; --text:#fff; --btn:#1aa37a; --btn-dark:#108663; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Naskh Arabic","Noto Sans Arabic",sans-serif;background:radial-gradient(1200px 700px at 70% -10%,#146c54 0%,#0b3d2e 50%,#06231a 100%);color:var(--text);min-height:100svh;display:grid;place-items:center;padding:24px}
    .app{width:100%;max-width:680px;background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.08);border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,0.25);backdrop-filter:blur(6px)}
    header{padding:20px 20px 0;text-align:center;position:sticky;top:0}
    h1{margin:0 0 6px;font-size:1.6rem;font-weight:800}
    .crumbs{padding:0 20px 10px;color:var(--accent-2)}
    main{max-height:calc(100svh - 24px - 24px);overflow:auto;border-radius:0 0 20px 20px}
    .list{padding:20px;display:grid;gap:12px;scroll-margin-block:80px}
    button.item,button.ayah,button.back{width:100%;border:0;border-radius:16px;padding:16px;text-align:center;cursor:pointer;background:linear-gradient(180deg,rgba(255,255,255,0.08),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.12);color:#fff;font-size:1.15rem;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.25)}
    button.ayah.playing{outline:3px solid var(--accent);box-shadow:0 0 0 4px rgba(163,217,201,0.18),0 10px 26px rgba(0,0,0,0.35)}
    .controls{display:none;grid-template-columns:1fr 1fr;gap:12px;padding:0 20px 16px}
    .controls.active{display:grid}
    .controls .group{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:10px 12px}
    .controls label{display:block;font-size:.85rem;color:var(--accent-2);margin-bottom:6px}
    .controls input{width:100%}
    .footer{display:none;padding:0 20px 20px;gap:10px;position:sticky;bottom:0;background:linear-gradient(180deg,rgba(11,61,46,0),rgba(11,61,46,0.6))}
    .footer.active{display:flex}
    .footer button{flex:1;padding:12px;border-radius:12px;border:0;font-weight:700;cursor:pointer;font-size:1rem}
    .primary{background:var(--btn);color:#fff}
    .primary:active{background:var(--btn-dark)}
    .muted{background:rgba(255,255,255,0.08);color:var(--accent-2);border:1px solid rgba(255,255,255,0.12)}
    .dua-wrap { display: grid; gap: 8px; }
    .dua-wrap.open .ayah { 
      outline: 3px solid var(--accent);
      box-shadow: 0 0 0 4px rgba(163,217,201,0.18),0 10px 26px rgba(0,0,0,0.35);
    }
    .tarjuma[hidden] { display: none !important; }
    .tarjuma {
      background: rgba(163, 217, 201, 0.08);
      border: 1px solid rgba(163, 217, 201, 0.25);
      border-radius: 12px;
      padding: 14px 16px;
      line-height: 1.7;
      color: var(--text);
      font-weight: 400; 
      font-size: 1rem;
    }
    /* ---------- Dua Reader Styles ---------- */
    #duaReader {
      position: fixed;
      inset: 0;
      background: radial-gradient(1200px 700px at 70% -10%,#146c54 0%,#0b3d2e 50%,#06231a 100%);
      z-index: 9999;
      display: none;
      grid-template-rows: auto 1fr;
    }
    .reader-header {
      position: fixed; top: 0; left: 0; right: 0;
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 24px;
      background: linear-gradient(180deg, rgba(6,35,26,0.8), rgba(6,35,26,0));
      z-index: 10;
    }
    #closeReaderBtn {
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(255,255,255,0.6);
      color: #0b3d2e; /* dark text for contrast */
      font-size: 1rem; padding: 8px 16px; border-radius: 10px;
      cursor: pointer; font-weight: 700;
    }
    .reader-title { color: var(--accent-2); font-size: 0.9rem; }
    .reader-scroller {
      height: 100vh;
      overflow-y: auto;
      scroll-snap-type: y mandatory;
      overscroll-behavior: contain;
    }
    .dua-slide {
      min-height: 100vh;
      scroll-snap-align: start;
      display: grid;
      place-items: center;
      padding: clamp(16px, 4vw, 48px);
      text-align: center;
    }
    .reader-arabic {
      font-size: clamp(28px, 5.5vw, 64px);
      font-weight: 700;
      line-height: 1.7;
      margin: 0 0 24px;
      color: var(--text);
      text-wrap: balance;
    }
    .reader-urdu {
      font-size: clamp(22px, 4.2vw, 48px);
      line-height: 1.8;
      margin: 0;
      color: var(--accent);
      max-width: 900px;
      text-wrap: balance;
    }
    .reader-nav {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      background: rgba(0,0,0,0.3);
      color: white; border: 1px solid rgba(255,255,255,0.3);
      width: 56px; height: 56px; border-radius: 50%;
      font-size: 24px; cursor: pointer;
      display: grid; place-items: center;
      animation: pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }
    .reader-nav.top { top: 70px; }
    .reader-nav.bottom { bottom: 20px; }
    @keyframes pulse { 0%, 100% { opacity: 0.9; } 50% { opacity: 0.4; } }
    @media (prefers-reduced-motion: reduce) { .reader-nav { animation: none; } }

  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>الکوثر – نماز و تلاوت</h1>
      <div id="crumbs" class="crumbs"></div>
    </header>

    <main id="scrollContainer">
      <div id="categoryList" class="list">
        <button class="item" data-category="namaz">نماز</button>
        <button class="item" data-category="tilawat">تلاوت</button>
        <button class="item" data-category="munajaat">مناجات مقبول</button>
      </div>
      <div id="itemList" class="list" style="display:none"></div>
      <div id="ayahList" class="list" style="display:none"></div>
      <div id="duaDaysList" class="list" style="display:none"></div>
      <div id="duaList" class="list" style="display:none"></div>
      <div id="backWrap" style="display:none;padding:0 20px 20px">
        <button id="backBtn" class="back">⬅️ واپس جائیں</button>
      </div>
      <section id="controls" class="controls">
        <div class="group">
          <label for="repeatCount">دہرائی (Repeat) – بار</label>
          <input id="repeatCount" type="number" min="1" max="50" value="1" inputmode="numeric"/>
          <div><label for="autoAdvance">خود اگلی آڈیو چلائیں</label> <input id="autoAdvance" type="checkbox" /></div>
        </div>
        <div class="group">
          <label for="speed">رفتار (Speed)</label>
          <input id="speed" type="range" min="0.5" max="1.5" step="0.05" value="1"/>
          <div><span id="speedVal">1.00×</span></div>
        </div>
      </section>
      <div id="footer" class="footer">
        <button id="stopBtn" class="muted">روکیں</button>
		  <button id="repeatAllBtn" class="primary">سب چلائیں</button>
      </div>
    </main>
  </div>

  <!-- Full-Screen Dua Reader -->
  <div id="duaReader" tabindex="-1">
    <header class="reader-header">
      <button id="closeReaderBtn">✖️ واپس</button>
      <span class="reader-title">مناجاتِ مقبول – جمعہ</span>
    </header>
    <div class="reader-scroller"></div>
    <button id="readerPrevBtn" class="reader-nav top" aria-label="Previous Dua">⬆️</button>
    <button id="readerNextBtn" class="reader-nav bottom" aria-label="Next Dua">⬇️</button>
  </div>

  <script>
    // ---------- Elements ----------
    const titleEl = document.querySelector('header h1');
    const crumbsEl = document.getElementById('crumbs');
    const categoryListEl = document.getElementById('categoryList');
    const itemListEl = document.getElementById('itemList');
    const ayahListEl = document.getElementById('ayahList');
    const duaDaysListEl = document.getElementById('duaDaysList');
    const duaListEl = document.getElementById('duaList');
    const backWrap = document.getElementById('backWrap');
    const backBtn = document.getElementById('backBtn');
    const controlsEl = document.getElementById('controls');
    const footerEl = document.getElementById('footer');
    const stopBtn = document.getElementById('stopBtn');
    const repeatAllBtn = document.getElementById('repeatAllBtn');
    const repeatCountInput = document.getElementById('repeatCount');
    const autoAdvanceChk = document.getElementById('autoAdvance');
    const speedSlider = document.getElementById('speed');
    const speedVal = document.getElementById('speedVal');
    // Dua Reader Elements
    const duaReaderEl = document.getElementById('duaReader');
    const readerScrollerEl = duaReaderEl.querySelector('.reader-scroller');
    const closeReaderBtn = document.getElementById('closeReaderBtn');
    const readerPrevBtn = document.getElementById('readerPrevBtn');
    const readerNextBtn = document.getElementById('readerNextBtn');

    // ---------- State ----------
    const AUTO_SCROLL = false;
    let currentAudio = null, currentIndex = -1, remainingRepeats = 1, playingAll = false;
    let buttons = [];
    let currentView = 'categories';
    let currentCategory = null;
    let currentKey = null;
    let currentDayKey = null;
    // Dua Reader State
    let currentReaderAudio = null;
    let readerCurrentIndex = -1;
    let readerObserver = null;
    let readerRemainingRepeats = 1;


    // ---------- Data ----------
    const namazKeys = ["takbeer","sanaa","tauz","tasmia","fatiha","ruku","tasmeeh","tahmeed","sajda","attahiyat","darood_ibrahimi","dua_rabbana","salaam"];
    const tilawatKeys = ["feel","quraish","kawthar","kafiroon","ikhlas","falaq","naas","ayatul-kursi"];

    const titles = {
      takbeer:"تکبیرِ تحریمہ", sanaa:"ثنا", tauz:"تعوذ", tasmia:"تسمیہ", fatiha:"سورہ فاتحہ",
      ruku:"رکوع", tasmeeh:"تسمیع", tahmeed:"تحمید", sajda:"سجدہ",
      attahiyat:"التحیات", darood_ibrahimi:"درودِ ابراہیمی", dua_rabbana:"دعا (رَبَّنَا)", salaam:"سلام",
      feel:"سورۃ الفیل", quraish:"سورۃ قریش", kawthar:"سورۃ الکوثر", kafiroon:"سورۃ الکافرون",
      ikhlas:"سورۃ الاخلاص", falaq:"سورۃ الفلق", naas:"سورۃ الناس", "ayatul-kursi":"آیت الکرسی"
    };
const surahs = {
      takbeer:["اللهُ اکبر"],
      sanaa:["مکمل ثنا","سُبْحَانَکَ اللّٰهُمَّ وَبِحَمْدِکَ","وَتَبَارَکَ اسْمُکَ","وَتَعَالیٰ جَدُّکَ","وَلَا اِلٰهَ غَيْرُکْ"],
      tauz:["اَعُوْذُ بِاللّٰہِ مِنَ الشَّیْطٰنِ الرَّجِیْم"],
      tasmia:["بِسْمِ اللّٰہِ الرَّحْمٰنِ الرَّحِیْم"],
      fatiha:["مکمل سورہ فاتحہ","اَلْحَمْدُ لِلّٰهِ رَبِّ الْعٰلَمِيْنَ","الرَّحْمٰنِ الرَّحِيْمِ","مٰلِكِ يَوْمِ الدِّيْنِ","اِيَّاكَ نَعْبُدُ وَاِيَّاكَ نَسْتَعِيْنُ","اِهْدِنَا الصِّرَاطَ الْمُسْتَقِيْمَ","صِرَاطَ الَّذِيْنَ اَنْعَمْتَ عَلَيْهِمْ   غَيْرِ الْمَغْضُوْبِ عَلَيْهِمْ وَلَا الضَّاۤلِّيْنَ"],
      ruku:["سُبْحَانَ رَبِّيَ الْعَظِيْمِ"],
      tasmeeh:["سَمِعَ اللّٰهُ لِمَنْ حَمِدَهٗ"],
      tahmeed:["رَبَّنَا لَكَ الْحَمْدُ"],
      sajda:["سُبْحَانَ رَبِّيَ الْأَعْلٰى"],
      attahiyat:["مکمل التحیات","اَلتَّحِيَّاتُ لِلّٰهِ وَالصَّلَوٰتُ وَالطَّيِّبَاتُ","اَلسَّلَامُ عَلَيْكَ اَيُّهَا النَّبِيُّ","وَرَحْمَةُ اللّٰهِ وَبَرَكَاتُهٗ","اَلسَّلَامُ عَلَيْنَا وَعَلٰی عِبَادِ اللّٰهِ الصَّالِحِيْن","اَشْهَدُ اَنْ لَّا اِلٰهَ اِلَّا اللّٰهُ","وَاَشْهَدُ اَنَّ مُحَمَّدًا عَبْدُهٗ وَرَسُوْلُهٗ"],
      darood_ibrahimi:["اَللّٰهُمَّ صَلِّ عَلٰی مُحَمَّدٍ وَّعَلٰى اٰلِ مُحَمَّدٍ","كَمَا صَلَّيْتَ عَلٰى اِبْرَاهِيْمَ وَعَلٰى اٰلِ اِبْرَاهِيْمَ","اِنَّكَ حَمِيْدٌ مَّجِيْدٌ","اَللّٰهُمَّ بَارِكْ عَلٰی مُحَمَّدٍ وَّعَلٰى اٰلِ مُحَمَّدٍ","كَمَا بَارَكْتَ عَلٰى اِبْرَاهِيْمَ وَعَلٰى اٰلِ اِبْرَاهِيْمَ","اِنَّكَ حَمِيْدٌ مَّجِيْدٌ"],
      dua_rabbana:["رَبَّنَا اٰتِنَا فِي الدُّنْيَا حَسَنَةً","وَّفِي الْاٰخِرَةِ حَسَنَةً","وَّقِنَا عَذَابَ النَّارِ"],
      salaam:["اَلسَّلَامُ عَلَيْكُمْ وَرَحْمَةُ اللّٰه - اَلسَّلَامُ عَلَيْكُمْ وَرَحْمَةُ اللّٰه"],
      feel:["مکمل سورہ فیل","أَلَمْ تَرَ كَيْفَ فَعَلَ رَبُّكَ بِأَصْحَابِ الْفِيلِ","أَلَمْ يَجْعَلْ كَيْدَهُمْ فِي تَضْلِيلٍ","وَأَرْسَلَ عَلَيْهِمْ طَيْرًا أَبَابِيلَ","تَرْمِيهِمْ بِحِجَارَةٍ مِّن سِجِّيلٍ","فَجَعَلَهُمْ كَعَصْفٍ مَّأْكُولٍ"],
      quraish:["لِإِيلَافِ قُرَيْشٍ","إِيلَافِهِمْ رِحْلَةَ الشِّتَاءِ وَالصَّيْفِ","فَلْيَعْبُدُوا رَبَّ هَذَا الْبَيْتِ","الَّذِي أَطْعَمَهُم مِّن جُوعٍ وَآمَنَهُم مِّنْ خَوْفٍ"],
      kawthar:["إِنَّا أَعْطَيْنَاكَ الْكَوْثَرَ","فَصَلِّ لِرَبِّكَ وَانْحَرْ","إِنَّ شَانِئَكَ هُوَ الْأَبْتَرُ"],
      kafiroon:["قُلْ يَا أَيُّهَا الْكَافِرُونَ","لَا أَعْبُدُ مَا تَعْبُدُونَ","وَلَا أَنتُمْ عَابِدُونَ مَا أَعْبُدُ","وَلَا أَنَا عَابِدٌ مَّا عَبَدتُّمْ","وَلَا أَنتُمْ عَابِدُونَ مَا أَعْبُدُ","لَكُمْ دِينُكُمْ وَلِيَ دِينِ"],
      ikhlas:["قُلْ هُوَ اللَّهُ أَحَدٌ","اللَّّهُ الصَّمَدُ","لَمْ يَلِدْ وَلَمْ يُولَدْ","وَلَمْ يَكُن لَّهُ كُفُوًا أَحَدٌ"],
      falaq:["قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ","مِن شَرِّ مَا خَلَقَ","وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ","وَمِن شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ","وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ"],
      naas:["قُلْ أَعُوذُ بِرَبِّ النَّاسِ","مَلِكِ النَّاسِ","إِلَٰهِ النَّاسِ","مِن شَرِّ الْوَسْوَاسِ الْخَنَّاسِ","الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ","مِنَ الْجِنَّةِ وَالنَّاسِ"],
      "ayatul-kursi":["اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ","لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ","لَهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ","مَن ذَا الَّذِي يَشْفَعُ عِندَهُ إِلَّا بِإِذْنِهِ","يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ","وَلَا يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلَّا بِمَا شَاءَ","وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ","وَلَا يَئُودُهُ حِفْظُهُمَا","وَهُوَ الْعَلِيُّ الْعَظِيمُ"]
    };

    const duaDays = [{key:'juma', label:'جمعہ دعا'}];
const munajaatAR = {
       juma:   ["نَحْمَدُكَ يَا خَيْرَ مَأْمُوْلٍ","  وَاَكْرَمَ مَسْئُوْلٍ","عَليٰ مَا عَلَّمْتَنَا مِنَ الْمُنَاجَاةِ الْمَقْبُوْلِ","مِنْ قُرُبٰتٍ عِنْدَاللّٰہِ وَصَلَوٰتِ الرَّسُوْلِ","فَصَلِّ عَلَيْہِ مَااخْتَلَفَ الدَّبُوْرُ وَالْقَبُوْلُ","وَانْشَعَبَتِ الْفُرُوْعُ مِنَ الْاُصُوْلِ","ثُمَّ نَسْئَلُكَ بِمَا سَنَقُوْلُ","وَمِنَّا السُّؤَالُ وَمِنْكَ الْقُبُوْلُ","يَارَبِّ يَارَبِّ يَارَبِّ",  "اَللّٰہُمَّ يَاكَبِيْرُ يَاسَمِيْعُ يَا بَصِيْرُ ", "يَامَنْ لَّاشَرِيْكَ لَہٗ وَلَا وَزِيْرَلَہٗ", "وَيَاخَالِقَ   الشَّمْسِ وَالْقَمَرِ الْمُنِيْرِ ",  " وَيَاعِصْمَةَ الْبَآىِٔسِ الْخَآىِٔفِ الْمُسْتَجِيْرِ",  " وَيَارَازِقَ الطِّفْلِ الصَّغِيْرِ",  "وَيَاجَابِرَ الْعَظْمِ الْكَسِيْرِ",  "اَدْعُوْكَ دُعَآءَ الْبَآىِٔسِ الْفَقِيْرِ كَدُعَآءِ الْمُضْطَرِّ الضَّرِيْرِ", 		 "اَسْأَلُكَ بِمَعَاقِدِ الْعِزِّمِنْ عَرْشِكَ وَبِمَفَاتِيْحِ الرَّحْمَةِ مِنْ كِتَابِكَ",  "وَبِالْاَسْمَآءِ الثَّمَانِيَةِ الْمَكْتُوْبَةِ عَليٰ قَرْنِ الشَّمْسِ اَنْ تَجْعَلَ الْقُرْاٰنَ رَبِيْعَ قَلْبِيْ وَجِلَآءَ حُزْنِيْ",  "رَبَّناۤ اٰتِنَا فِي الدُّنْيَا ﴿ كَذَاوَكَذَا﴾ ",  "يَا مُوْنِسَ كُلِّ وَحِيْدٍ",  " وَّيَاصَاحِبَ كُلِّ فَرِيْدٍ", "وَّيَا قَرِيْبًا غَيْرَ بَعِيْدٍ وَّيَا شَاہِدًا غَيْرَ غَآىِٔبٍ", " وَّيَاغَالِبًا غَيْرَ مَغْلُوْبٍ، يَّاحَيُّ يَاقَيُّوْمُ",   "يَاذَالْجَلَالِ وَالْاِكْرَامِ",  "يَانُوْرَ السَّمٰوٰتِ وَالْاَرْضِ، وَيَازَيْنَ السَّمٰوٰتِ وَالْاَرْضِ",   "يَاجَبَّارَ السَّمٰوٰتِ وَالْاَرْضِ",  "يَا عِمَادَ السَّمٰوٰتِ وَالْاَرْضِ",  " يَابَدِيْعَ السَّمٰوٰتِ وَالْاَرْضِ", " وَيَاقَيَّامَ السَّمٰوٰتِ وَالْاَرْضِ",  "يَاذَالْجَلَالِ وَالْاِكْرَامِ يَاصَرِيْخَ الْمُسْتَصْرِخِيْنَ وَمُنْتَہَي الْعَآىِٔذِيْنَ",  " وَالْمُفَرِّجُ عَنِ الْمَكْرُوْبِيْنَ",  " وَالْمُرَوِِّحُ عَنِ الْمَغْمُوْمِيْنَ، وَمُجِيْبَ dُعَآءِ الْمُضْطَرِّيْنَ",  "وَيَاكَاشِفَ الْمَكْرُوْبِ",   " يَاۤاِلٰہَ الْعٰلَمِيْنَ وَ يَاۤاَرْحَمَ الرّٰاحِمِيْنَ مَنْزُوْلٌۭ بِكَ كُلُّ حَاجَۃٍ",  "اَللّٰہُمَّ اِنَّكَ خَلَّاقٌ عَظِیْمٌ"," اِنَّكَ سَمِیْعٌ عَلِیْمٌ ","اِنَّكَ غَفُوْرٌ رَّحِیْمٌ"," اِنَّكَ رَبُّ الْعَرْشِ الْعَظِیْمِ","اَللّٰہُمَّ اِنَّكَ الْبَرُّ الْجَوَّادُ الْكَرِیْمُ ","اغْفِرْلِیْ وَارْحَمْنِیْ وَعَافِنِیْ"," وَارْزُقْنِیْ وَاسْتُرْنِیْ  وَاجْبُرْنِیْ"," وَارْفَعْنِیْ  وَاہْدِنِیْ وَلَا تُضِلَّنِیْ"," وَاَدْخِلْنِیَ الْجَنَّۃَ بِرَحْمَتِكَ یَاۤاَرْحَمَ الرّٰحِمِیْنَ","اِلَیْكَ رَبِّ فَحَبِّبْنِیْ"," وَفِیْ نَفْسِیْ لَكَ فَذَلِّلْنِیْ ","وَفِیْۤ اَعْیُنِ النَّاسِ فَعَظِّمْنِیْ ","وَمِنْ سَیِّءِ الْاَخْلَاقِ  فَجَنِّبْنِیْ"," اَللّٰہُمَّ اِنَّكَ سَاَلْتَنَا مِنْ اَنْفُسِنَا مَالَا نَمْلِكُہٗۤ اِلَّابِكَ ","فَاَعْطِنَا مِنْہَامَا یُرْضِیْكَ عَنَّا", "اَللّٰہُمَّ اِنِّیْۤ اَسْاَلُكَ اِیْمَانًا دَآىِٔمًا",  "وَّاَسْاَلُكَ قَلْبًا خَاشِعًا",  "وَّاَسْاَلُكَ یَقِیْنًا صَادِقًا",  "وَّاَسْاَلُكَ دِیْنًا قَیِّمًا",  "وَّاَسْاَلُكَ الْعَافِیَۃَ مِنْ كُلِّ bَلِیَّۃٍ",  "وَاَسْاَلُكَ دَوَامَ الْعَافِیَۃِ",  "وَاَسْاَلُكَ الشُّكْرَعَلَی الْعَافِیَۃِ",  "وَاَسْاَلُكَ الْغِنٰی عَنِ النَّاسِ",  "اَللّٰہُمَّ اِنِّیْۤ اَسْتَغْفِرُكَ لِمَا تُبْتُ اِلَیْكَ مِنْہُ ثُمَّ عُدْتُّ فِیْہِ",  "وَاَسْتَغْفِرُكَ لِمَاۤaَعْطَیْتُكَ مِنْ نَّفْسِیْ ثُمَّ لَمْ اُوْفِ لَكَ بِہٖ",  "وَاَسْتَغْفِرُكَ لِلنِّعَمِ الَّتِیْ تَقَوَّیْتُ بِہَا عَلیٰ مَعْصِیَتِكَ",  "وَاَسْتَغْفِرُكَ لِکُلِّ خَیْرٍاَرَدْتُّ بِہٖ وَجْہَكَ  فَخَالَطَنِیْ فِیْہِ مَالَیْسَ لَكَ",  "اَللّٰہُمَّ لَا تُخْزِنِیْ فَاِنَّكَ بِیْ عَالِمٌ",  "وَّلَا تُعَذِّبْنِیْ فَاِنَّكَ عَلَیَّ قَادِرٌ", "اَللّٰہُمَّ رَبَّ السَّمٰوَاتِ السَّبْعِ",  "وَرَبَّ الْعَرْشِ الْعَظِیْمِ",  "اَللّٰہُمَّ اكْفِنِیْ كُلَّ مُہِمٍّ مِّنْ حَیْثُ شِئْتَ  وَمِنْ اَیْنَ شِئْتَ",  "حَسْبِیَ اللہُ لِدِیْنِیْ",  "حَسْبِیَ اللہُ لِدُنْیَایَ",  "حَسْبِیَ اللہُ لِمَاۤ اَہَمَّنِیْ",  "حَسْبِیَ اللہُ لِمَنْۭ بَغٰی عَلَیَّ",  "حَسْبِیَ اللہُ لِمَنْ حَسَدَنِیْ",  "حَسْبِیَ اللہُ لِمَنْ كَادَنِیْ بِسُوٓءٍ",  "حَسْبِیَ اللہُ عِنْدَ الْمَوْتِ",  "حَسْبِیَ اللہُ عِنْدَ الْمَسْئَلَۃِ فِی الْقَبْرِ",  "حَسْبِیَ اللہُ عِنْدَ الْمِیْزَانِ",  "حَسْبِیَ اللہُ عِنْدَ الصِّرَاطِ",  "حَسْبِیَ اللہُ لَااِلٰہَ اِلَّاہُوَ",  "عَلَیْہِ تَوَكَّلْتُ",  "وَہُوَ رَبُّ الْعَرْشِ الْعَظِیْمِ", "اَللّٰہُمَّ اِنِّیْ اَسْاَلُكَ ثَوَابَ الشَّاكِرِیْنَ",  "وَنُزُلَ الْمُقَرَّبِیْنَ",  "وَمُرَافَقَۃَ النَّبِیِّیْنَ",  "وَیَقِیْنَ الصِّدِّیْقِیْنَ",  "وَذِلَّۃَ الْمُتَّقِیْنَ",  "وَاِخْبَاتَ الْمُوْقِنِیْنَ",  "حَتّٰی تَوَفَّانِیْ عَلیٰ ذَالِكَ",  "یَاۤ اَرْحَمَ الرَّاحِمِیْنَ", "اَللّٰہُمَّ اِنِّیْ اَسْاَلُكَ بِنِعْمَتِكَ السَّابِقَۃِ عَلَیَّ", "وَبَلَاۤىِٔكَ الْحَسَنِ الَّذِیْ ابْتَلَیْتَنِیْ بِہٖ", "وَفَضْلِكَ الَّذِیْ فَضَّلْتَ عَلَیَّ", "اَنْ تُدْخِلَنِیَ الْجَنَّۃَ بِمَنِّكَ  وَفَضْلِكَ وَرَحْمَتِكَ", "اَللّٰہُمَّ اِنِّی اَسْاَلُكَ اِیْمَانًا دَآىِٔمًا", "وَّہُدًی قَیِّمًا", "وَّعِلْمًا نَّافِعًا", "اَللّٰہُمَّ لَا تَجْعَلْ لِفَاجِرٍ", "عِنْدِیْ نِعْمَۃً اُكَافِیْہِ بِہَا", "فِی الدُّنْیَا وَ الْاٰخِرَۃِ", "اَللّٰہُمَّ اغْفِرْلِیْ ذَنْۢبِیْ", "وَوَسِّعْ لِیْ خُلُقِیْ", "وَطَیِّبْ لِیْ كَسْبِیْ", "وَقَنِّعْنِیْ بِمَا رَزَقْتَنِیْ", "وَلَا تُذْہِبْ طَلَبِیْ اِليٰ شَیْءٍ صَرَّفْتَہٗ عَنِّیْ", "اَللّٰہُمَّ اِنِّیْ اَسْتَجِیْرُكَ مِنْ جَمِیْعِ كُلِّ شَیْءٍ خَلَقْتَ", "وَاَحْتَرِسُ بِكَ مِنْہُنَّ", "وَاجْعَلْ لِّیْ عِنْدَكَ وَلِیْجَۃً", "وَّاجْعَلْ لِّیْ عِنْدَكَ زُلْفٰی", "وَحُسْنَ مَاٰبٍ", "وَّاجْعَلْنِیْ مِمَّنْ یَّخَافُ", "مَقَامَكَ وَ وَعِیْدَكَ", "وَیَرْجُوْا لِقَآئَكَ", "وَاجْعَلْنِیْ مِمَّنْ یَّتُوْبُ اِلَیْكَ تَوْبَۃً نَّصُوْحًا", "وَّاَسْاَلُكَ عَمَلاً مُّتَقَبَّلًا", "وَّعِلْمًا نَّجِیْحًا  وَّسَعْیًا مَّشْكُوْرًا", "وَّتِجَارَۃً لَّنْ تَبُوْرَ", "اَللّٰہُمَّ اِنِّیْ اَسْاَلُكَ فِكَاكَ رَقَبَتِیْ مِنَ النَّارِ", "اَللّٰہُمَّ اَعِنِّیْ عَلیٰ غَمَرَاتِ الْمَوْتِ وَسَكَرَاتِ الْمَوْتِ", "اَللّٰہُمَّ اغْفِرْلِیْ وَارْحَمْنِیْ وَاَلْحِقْنِیْ بِالرَّفِیْقِ الْاَعْلیٰ", "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنْ اَنْ اُشْرِكَ بِكَ شَیْئًا وَّاَنَا اَعْلَمُ", "وَاَسْتَغْفِرُكَ لِمَالَاۤ اَعْلَمُ بِہٖ", "وَاَعُوْذُبِكَ اَنْ یَّدْعُوَ عَلَیَّ رَحِمٌ قَطَعْتُہَا", "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنْ شَرِّمَنْ یَّمْشِیْ عَلیٰ bَطْنِہٖ", "وَمِنْ شَرِّ مَنْ یَّمْشِیْ عَلیٰ rِجْلَیْنِ", "وَمِنْ شَرِّ مَنْ یَّمْشِیْ عَلیٰۤ اَرْبَعٍ", "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنِ امْرَاَۃٍ تُشَیِّبُنِیْ قَبْلَ الْمَشِیْبِ", "وَاَعُوْذُبِكَ مِنْ وَّلَدٍ یَّكُونُ عَلَیَّ وَبَالًا", "وَّاَعُوْذُبِكَ مِنْ مَّالٍ یَّكُونُ عَلَیَّ عَذَابًا", "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنَ الشَّكِّ فِی الْحَقِّ بَعْدَ الْیَقِیْنِ", "وَاَعُوْذُبِكَ مِنَ الشَّیْطٰنِ الرَّجِیْمِ", "وَاَعُوْذُبِكَ مِنْ شَرِّ یَوْمِ الدِّیْنِ", "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنْ مَّوْتِ الْفُجَآءَۃِ", "وَمِنْ لَّدْغِ الْحَیَّۃِ وَمِنَ السَّبُعِ", "وَمِنَ الْغَرَقِ وَمِنَ الْحَرَقِ", "وَمِنْ اَنْ اَخِرَّعَلَیٰ شَیْءٍ", "وَّمِنَ الْقَتْلِ عِنْدَ فِرَارِ الزَّحْفِ", "وَتَقَبَّلْ ھٰذِہِ الدَّعْوَاتِ", "فِیْ حَقِّ مُحَمَّد اَشْرَفْ عَلِیْ وَ كاكا صاحب وَعَبْدِ الْوَاسِعْ وَمُحَمَّدْ مُصْطَفیٰ وَمُحَمَّدْ عَلِیْ وَمُحَمَّدْ شفیع وَعَبْدِالْمَاجِدْ وَمَوْلَانَا اشرف سُلَیْمَانِیْ ومولانا زکریا وَصوفی مُحَمَّدْ اِقْبَال مدنی وسَیَّدعَلِیْ شاہ وَسَیَّد تَسْنِیْمُ الْحَق وسَیَّد تَنْظِیْمُ الْحَقْ رَحْمَۃُاللہِ تَعَالٰی عَلَیْہِم", "وَجَمِیْعِ الْمُتَعَلِّقِیْن وَفِیْ حَقِّ اَبَاىِٔہِمْ وَ اُمَّہَاتِہِمْ", "وَجَمِیْعِ الْمُوْمِنِیْنَ وَ الْمُوْمِنَاتِ", "وَصَلَّی اللہُ تَعَالیٰ عَلیٰ سَیِّدِ الْکَآىِٔنَاتِ وَ اَکْرَمِ الْمَخْلُوْقَاتِ صَلٰوۃً تَسْبِقُ الْغَایَاتِ"]
    };

    const munajaatUR = {
      juma: ["اے ان سب سے بہتر جن سے اميد قائم کی جا سکتی ہے،","اور اے ان سب سے کريم تر جن سے کچھ طلب کيا جا سکے،","ہم تيری حمد کرتے ہيں کہ تو نے ہميں مناجات مقبول سکھائی۔","جو اللہ کے ہاں موجب قربت ہے اور رسول اللہﷺ کی دعائيں سکھائيں۔","تو (يا اللہ) ان (رسولﷺ) پر رحمت کامل نازل فرما جب تک کہ پچھوا (مغربی) اور پروا (شرقی) ہوائيں چلتی رہيں،","اور جڑوں سے شاخيں پھوٹتی رہیں۔","اس کے بعد ہم تجھ سے وہ طلب کرتے ہيں، جو ابھی (آگے) عرض کرتے ہيں۔","ہمارا کام طلب کرنا ہے اور آپ کا کام عطا کرنا۔","اے ميرے پروردگار، اے ميرے پروردگار، اے ميرے پروردگار۔","يا اللہ، اے بڑائی والے، اے سننے والے، اے ديکھنے والے۔","اے وہ کہ جس کا نہ کوئی شريک ہے اور نہ مشير۔","اے آفتاب و ماہتابِ روشن کے پيدا کرنے والے۔","اور اے مصيبت زدہ، ترساں و پناہ جو کے ليے پناہ۔","اور اے ننھے بچے کی روزی پہنچانے والے۔","اور اے ٹوٹی ہوئی ہڈی کے جوڑنے والے۔","ميں تجھ سے درخواست کرتا ہوں مصيبت زدہ محتاج کی سی درخواست، بے قرار آفت زدہ کی سی درخواست۔","تجھ سے سوال کرتا ہوں تيرے عرش کے بند ہائے عزّت کے واسطہ سے اور تيری کتاب کی کليد ہائے رحمت کے واسطہ سے،","اور ان آٹھ ناموں کے واسطہ سے جو رُخِ آفتاب پر لکھے ہوئے ہيں، يہ کہ قرآن کو ميرے دِل کی بہار اور ميرے غم کی کشائش بنا دے۔","اے ہمارے پروردگار ہميں دُنيا ميں فلاں فلاں چيز عطا کر۔ (کذا و کذا کی جگہ اپنے جائز دنیاوی مقصد کا تصور کریں)","اے ہر اکيلے کے غمگسار،","اور اے ہر تنہا کے رفيق،","اور اے ايسے قريب جو دور نہيں، اور اے ايسے حاضر جو غائب نہيں،","اور اے ايسے غالب جو مغلوب نہيں، اے ہمیشہ زندہ، اے سب کو قائم رکھنے والے،","اے بزرگی اور عظمت والے۔","اے آسمانوں اور زمين کے نور، اور اے آسمانوں اور زمين کی زينت۔","اے آسمانوں اور زمينوں کا انتظام رکھنے والے۔","اے آسمانوں اور زمين کو تھامنے والے۔","اے آسمانوں اور زمين کے موجد۔","اور اے آسمانوں اور زمين کے قائم رکھنے والے۔","اے بزرگی اور عظمت والے، اے فرياديوں کے داد رس اور پناہ مانگنے والوں کی آخری امید۔","اور اے بے چينوں کو کشائش دينے والے،","اور غمزدوں کو راحت دينے والے، اور بے قراروں کی دُعا قبول کرنے والے،","اور اے مصیبت زدہ کو شفا دينے والے۔","اے تمام جہانوں کے معبود اور اے سب سے بڑھ کر رحم کرنے والے، تيرے ہی سامنے ہر حاجت پيش ہے۔","يا اللہ تو بڑا پیدا کرنے والا ہے۔","بے شک تو سب کچھ سننے والا، سب کچھ جاننے والا ہے۔","بے شک تو بخشنے والا، رحم کرنے والا ہے۔","بے شک تو ہی عرشِ عظيم کا مالک ہے۔","يا اللہ بے شک تو محسن ہے، بہت عطا کرنے والا، کرم کرنے والا ہے۔","تو مجھے بخش دے، اور مجھ پر رحم کر، اور مجھے عافیت دے،","اور مجھے روزی دے، اور ميری پردہ پوشی فرما، اور ميرے نقصان کو پورا کر دے،","اور مجھے بلندی عطا فرما، اور مجھے ہدايت دے اور مجھے گمراہ نہ کر،","اور مجھے اپنی رحمت سے جنت ميں داخل فرما، اے سب سے بڑھ کر رحم کرنے والے۔","اے ميرے پروردگار! مجھے اپنا محبوب بنا لے۔","اور ميرے نفس کو اپنے لیے جھکا دے۔","اور لوگوں کی نظروں ميں مجھے عزت عطا فرما۔","اور بُرے اخلاق سے مجھے بچا لے۔","يا اللہ! تو نے ہم سے ہمارے نفسوں سے وہ چیز مانگی جس پر ہم تیرے بغیر قادر نہیں۔","پس ہمیں اس میں سے وہ عطا فرما جو تجھے ہم سے راضی کر دے۔","يا اللہ ميں تجھ سے ہميشہ رہنے والا ايمان طلب کرتا ہوں۔","اور تجھ سے خشوع والا دِل طلب کرتا ہوں۔","اور تجھ سے سچا يقين طلب کرتا ہوں۔","اور تجھ سے سیدھا دین طلب کرتا ہوں۔","اور تجھ سے ہر مصیبت سے عافیت طلب کرتا ہوں۔","اور تجھ سے ہمیشہ کی عافیت طلب کرتا ہوں۔","اور تجھ سے عافیت پر شکر ادا کرنے کی توفیق طلب کرتا ہوں۔","اور تجھ سے لوگوں سے بے نيازی طلب کرتا ہوں۔","يا اللہ! میں تجھ سے اس گناہ کی معافی چاہتا ہوں جس سے ميں نے توبہ کی اور پھر اس میں واپس لوٹ گیا۔","اور تجھ سے اس وعدے کی معافی چاہتا ہوں جو ميں نے اپنی طرف سے کیا اور پھر اسے پورا نہ کر سکا۔","اور تجھ سے ان نعمتوں کی معافی چاہتا ہوں جن سے ميں نے طاقت حاصل کر کے تيری نافرمانی کی۔","اور تجھ سے ہر اس نیکی کی معافی چاہتا ہوں جس میں، میں نے تیری رضا کا ارادہ کیا لیکن پھر اس میں غیر اللہ کی آمیزش ہوگئی۔","يا اللہ! مجھے رسوا نہ کرنا، بے شک تُو مجھے خوب جانتا ہے۔","اور مجھ پر عذاب نہ کرنا، بے شک تُو مجھ پر ہر طرح قدرت رکھتا ہے۔","يا اللہ! ساتوں آسمانوں کے مالک،","اور عرشِ عظيم کے مالک۔","يا اللہ! تو ميرے ليے ہر اہم کام میں کافی ہو جا جس طرح تُو چاہے اور جہاں سے تُو چاہے۔","کافی ہے مجھے اللہ ميرے دين کے ليے۔","کافی ہے مجھے اللہ ميری دُنيا کے ليے۔","کافی ہے مجھے اللہ ميری فکروں کے ليے۔","کافی ہے مجھے اللہ اُس شخص کے مقابلے کے ليے جو مجھ پر زيادتی کرے۔","کافی ہے مجھے اللہ اُس شخص کے ليے جو مجھ سے حسد کرتا ہو۔","کافی ہے مجھے اللہ اُس شخص کے ليے جو مجھے بُرائی کے ساتھ دھوکا دیتا ہے۔","کافی ہے مجھے اللہ موت کے وقت۔","کافی ہے مجھے اللہ قبر میں سوال کے وقت۔","کافی ہے مجھے اللہ ميزان (حشر) کے پاس۔","کافی ہے مجھے اللہ صراط (محشر) کے پاس۔","کافی ہے مجھے اللہ، کہ کوئی معبود نہیں ہے سوائے اُس کے۔","اُسی پر ميں نے بھروسہ کيا ہے،","اور وہی عرشِ عظيم کا مالک ہے۔","يا اللہ ميں تجھ سے شکر گزاروں کا ثواب مانگتا ہوں۔","اور مقربين کی سی مہمان نوازی مانگتا ہوں۔","اور انبياء کی رفاقت مانگتا ہوں۔","اور صديقوں کا سا يقين مانگتا ہوں۔","اور متقیوں کی سی عاجزی مانگتا ہوں۔","اور اہلِ يقين کا سا خشوع مانگتا ہوں،","یہاں تک کہ تُو اسی حال پر مجھے موت دے،","اے سب رحم کرنے والوں سے بڑھ کر رحم کرنے والے۔","يا اللہ ميں تجھ سے سوال کرتا ہوں تیری اس نعمت کے واسطے جو مجھ پر پہلے سے ہے،","اور اس اچھے امتحان کے واسطے جس میں تُو نے مجھے مبتلا کیا،","اور اس فضل کے واسطے جو تُو نے مجھ پر کيا ہے،","کہ تُو مجھے اپنے احسان، فضل اور رحمت سے جنت ميں داخل کرے۔","يا اللہ ميں تجھ سے ہمیشہ رہنے والا ايمان طلب کرتا ہوں،","اور سیدھی راہنمائی،","اور نفع بخش علم۔","يا اللہ! کسی بدکار کا،","مجھ پر ایسا احسان نہ ہونے دے جس کا بدلہ مجھے چکانا پڑے،","دنیا اور آخرت میں۔","يا اللہ! ميرے گناہ بخش دے،","اور ميرے اخلاق کو وسیع کر دے،","اور ميری کمائی کو پاک کر دے،","اور جو کچھ تُو نے مجھے دیا ہے اس پر مجھے قناعت عطا فرما،","اور ميری طلب کو اُس چيز کی طرف نہ لے جا جو تُو نے مجھ سے ہٹا لی ہو۔","يا اللہ ميں تيری پناہ چاہتا ہوں ہر اس چیز سے جو تُو نے پيدا کی ہے،","اور ان سب سے تيری حفاظت ميں آتا ہوں۔","اور ميرے ليے اپنے ہاں رسائی پیدا کر دے۔","اور ميرے ليے اپنے ہاں تقرّب،","اور اچھا ٹھکانہ بنا دے۔","اور مجھے اُن لوگوں ميں سے کر دے جو ڈرتے ہیں،","تیرے سامنے کھڑے ہونے سے اور تيری وعيد سے،","اور تيرے ديدار کی امید رکھتے ہيں۔","اور مجھے اُن لوگوں ميں سے کر دے جو تيری طرف سچی توبہ کے ساتھ رجوع کرتے ہيں۔","اور تجھ سے عملِ مقبول طلب کرتا ہوں،","اور کارآمد علم اور مقبول کوشش،","اور ایسی تجارت جس میں کبھی خسارہ نہ ہو۔","يا اللہ ميں تجھ سے اپنی گردن کو آگ سے چھڑانے کا سوال کرتا ہوں۔","يا اللہ! موت کی سختیوں اور بے ہوشیوں پر ميری مدد فرما۔","يا اللہ! مجھے بخش دے، اور مجھ پر رحم فرما، اور مجھے اعلیٰ ساتھیوں کے ساتھ ملا دے۔","يا اللہ ميں تيری پناہ ميں آتا ہوں اس سے کہ میں جانتے بوجھتے تیرے ساتھ کسی کو شریک کروں،","اور تجھ سے اس (شرک) کی معافی چاہتا ہوں جسے میں نہیں جانتا۔","اور تيری پناہ ميں آتا ہوں اس سے کہ مجھے کوئی ایسا رشتہ دار بد دعا دے جس کی ميں نے حق تلفی کی ہو۔","يا اللہ ميں تيری پناہ ميں آتا ہوں اُس مخلوق کے شر سے جو پيٹ کے بل چلتی ہے،","اور اُس مخلوق کے شر سے جو دو پيروں پر چلتی ہے،","اور اُس مخلوق کے شر سے جو چار پيروں پر چلتی ہے۔","يا اللہ ميں تيری پناہ ميں آتا ہوں ايسی عورت سے جو مجھے بڑھاپے سے پہلے ہی بوڑھا کر دے،","اور تيری پناہ ميں آتا ہوں ايسی اولاد سے جو مجھ پر وبال بن جائے،","اور تيری پناہ ميں آتا ہوں ايسے مال سے جو میرے لیے عذاب بن جائے۔","يا اللہ ميں تيری پناہ ميں آتا ہوں حق پر یقین کے بعد شک کرنے سے،","اور تيری پناہ ميں آتا ہوں شيطان مردود سے،","اور تيری پناہ ميں آتا ہوں قیامت کے دن کے شر سے۔","يا اللہ ميں تيری پناہ ميں آتا ہوں اچانک موت سے،","اور سانپ کے کاٹنے سے اور درندے سے،","اور ڈُوبنے سے اور جل جانے سے،","اور اس سے کہ کسی چيز پر گر پڑوں،","اور میدانِ جنگ سے بھاگتے ہوئے مارے جانے سے۔","اور ان دعاؤں کو قبول فرما۔","محمد اشرف علی کے حق میں،اور کاکا صاحب کے حق میں،اور عبدالواسع اور محمد مصطفیٰ کے حق میں،اور محمد علی اور محمد شفیع کے حق میں،اور عبد الماجد کے حق میں،اور مولانا اشرف سلیمانی کے حق میںاور مولانا زکریا کے حق میںاور صوفی محمد اقبال مدنی کے حق میں،اور سید علی شاہ کے حق میں،اور سید تسنیم الحق کے حق میں،اور سید تنظیم الحق رحمۃ اللہ تعالیٰ علیہم کے حق میں،","اور تمام متعلقین اور ان کے والدین کے حق میں","اور تمام مومن مردوں اور مومن عورتوں کے حق میں","اور اللہ تعالیٰ تمام کائنات کے سردار اور تمام مخلوقات میں سب سے بزرگ پر رحمت نازل فرمائے،ایسی رحمت جو تمام مقاصد سے سبقت لے جائے۔"]
    };

    const munajaatPauses = { juma: [18] };

    // ---------- Helpers ----------
    function setCrumbs(parts){ crumbsEl.textContent = parts.filter(Boolean).join(" › "); }
    function updateSpeedLabel(){ speedVal.textContent = Number(speedSlider.value).toFixed(2)+'×'; }
    updateSpeedLabel();
    speedSlider.addEventListener('input',()=>{ updateSpeedLabel(); if(currentAudio) currentAudio.playbackRate = Number(speedSlider.value); if(currentReaderAudio) currentReaderAudio.playbackRate = Number(speedSlider.value); });
    function clearPlayingStyles(){ buttons.forEach(b=>b.classList.remove('playing')); }
    function autoScroll(el){ try { el.scrollIntoView({behavior:'smooth', block:'center', inline:'nearest'}); } catch(e){} }
    function stopPlayback(){ playingAll=false; if(currentAudio){ currentAudio.pause(); currentAudio=null; } clearPlayingStyles(); currentIndex=-1; }
    stopBtn.addEventListener('click', stopPlayback);
    function shouldPauseAfter(ix){ if(currentView!=='duas' || !currentDayKey) return false; const arr = munajaatPauses[currentDayKey] || []; return arr.includes(ix); }

    function safePlay(btn) {
      const ix = buttons.indexOf(btn);
      if (ix >= 0) {
        playingAll = false;
        playIndex(ix);
      }
    }

    function playIndex(ix){
      const btn = buttons[ix]; if(!btn) return;
      const pauseThisItem = shouldPauseAfter(ix);
      if(currentAudio){ currentAudio.pause(); currentAudio=null; }
      clearPlayingStyles();
      btn.classList.add('playing');
      const scrollTarget = btn.closest('.dua-wrap') || btn;
      if (AUTO_SCROLL) autoScroll(scrollTarget);
      
      const audio = new Audio(btn.dataset.file);
      audio.playbackRate = Number(speedSlider.value);
      currentAudio = audio; currentIndex = ix;
      
      const repeatOverride = (playingAll && currentView === 'ayahs') ? 3 : null;
      remainingRepeats = pauseThisItem ? 1 : (repeatOverride ?? Number(repeatCountInput.value || 1));

      audio.addEventListener('ended', ()=>{
        remainingRepeats--;
        if(remainingRepeats > 0){ audio.currentTime = 0; audio.play(); return; }
        if(pauseThisItem){ playingAll = false; return; }
        if(playingAll || autoAdvanceChk.checked){
          if(ix + 1 < buttons.length){ playIndex(ix + 1); } 
          else { playingAll = false; clearPlayingStyles(); }
        } else { clearPlayingStyles(); }
      });
      audio.play();
    }

    repeatAllBtn.addEventListener('click', () => {
      duaListEl.querySelectorAll('.dua-wrap').forEach(w => w.classList.remove('open'));
      duaListEl.querySelectorAll('.tarjuma').forEach(p => p.hidden = true);
      playingAll = true;
      playIndex(0);
    });

    // ---------- Dua Reader Logic ----------
    function playReaderDua(index) {
        if (currentReaderAudio) { currentReaderAudio.pause(); currentReaderAudio = null; }
        if (index < 0) return;

        readerCurrentIndex = index;
        const audio = new Audio(duaAudioPath('juma', index));
        audio.playbackRate = Number(speedSlider.value);
        currentReaderAudio = audio;
        readerRemainingRepeats = 1; // Force single play in projector mode

        audio.addEventListener('ended', () => {
            readerRemainingRepeats--;
            if (readerRemainingRepeats > 0) {
                audio.currentTime = 0;
                audio.play();
            }
        });
        audio.play().catch(e => console.error("Audio play failed:", e));
    }

    function handleReaderKeyDown(e) {
        if (e.key === 'ArrowDown') { e.preventDefault(); navigateReader(1); }
        if (e.key === 'ArrowUp') { e.preventDefault(); navigateReader(-1); }
        if (e.key === 'Escape') { closeJumaReader(); }
    }

    function openJumaReader(startIndex) {
        stopPlayback(); // Stop any main app audio
        readerScrollerEl.innerHTML = '';

        const duas = munajaatAR.juma;
        const translations = munajaatUR.juma;
        
        duas.forEach((arabicText, i) => {
            const slide = document.createElement('section');
            slide.className = 'dua-slide';
            slide.dataset.index = i;

            const content = document.createElement('div');
            const arabicEl = document.createElement('p');
            arabicEl.className = 'reader-arabic';
            arabicEl.textContent = arabicText;
            content.appendChild(arabicEl);

            if (translations[i]) {
                const urduEl = document.createElement('p');
                urduEl.className = 'reader-urdu';
                urduEl.textContent = translations[i];
                content.appendChild(urduEl);
            }
            slide.appendChild(content);
            readerScrollerEl.appendChild(slide);
        });

        duaReaderEl.style.display = 'grid';
        duaReaderEl.focus();
        window.addEventListener('keydown', handleReaderKeyDown);

        // Scroll to start index
        const targetSlide = readerScrollerEl.querySelector(`.dua-slide[data-index="${startIndex}"]`);
        if (targetSlide) {
            targetSlide.scrollIntoView({ block: "start" });
        }

        if (readerObserver) readerObserver.disconnect();
        readerObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const newIndex = parseInt(entry.target.dataset.index, 10);
                    if (newIndex !== readerCurrentIndex) {
                        playReaderDua(newIndex);
                    }
                }
            });
        }, { threshold: 0.6 });

        readerScrollerEl.querySelectorAll('.dua-slide').forEach(slide => readerObserver.observe(slide));
        
        // Initial play for the opened slide
        playReaderDua(startIndex);
    }

    function closeJumaReader() {
        if (currentReaderAudio) { currentReaderAudio.pause(); currentReaderAudio = null; }
        if (readerObserver) { readerObserver.disconnect(); readerObserver = null; }
        window.removeEventListener('keydown', handleReaderKeyDown);
        duaReaderEl.style.display = 'none';
        readerCurrentIndex = -1;
    }

    function navigateReader(direction) {
        const totalSlides = munajaatAR.juma.length;
        let nextIndex = readerCurrentIndex + direction;
        if (nextIndex >= 0 && nextIndex < totalSlides) {
            const nextSlide = readerScrollerEl.querySelector(`.dua-slide[data-index="${nextIndex}"]`);
            if(nextSlide) nextSlide.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    closeReaderBtn.addEventListener('click', closeJumaReader);
    readerPrevBtn.addEventListener('click', () => navigateReader(-1));
    readerNextBtn.addEventListener('click', () => navigateReader(1));
    

    // ---------- Build Lists ----------
    function openCategory(cat){
      currentCategory = cat;
      if(cat==='namaz'){ titleEl.textContent='نماز – اذکار و قراءت'; setCrumbs(['نماز']); buildItems(namazKeys); show('items'); }
      else if(cat==='tilawat'){ titleEl.textContent='تلاوت – سورتیں و آیات'; setCrumbs(['تلاوت']); buildItems(tilawatKeys); show('items'); }
      else if(cat==='munajaat'){ titleEl.textContent='مناجات مقبول – ایام'; setCrumbs(['مناجات مقبول']); buildDuaDays(); show('days'); }
    }

    function buildItems(keys){
      itemListEl.innerHTML='';
      keys.forEach(key=>{
        const b=document.createElement('button');
        b.className='item'; b.textContent=titles[key]||key; b.dataset.key=key;
        b.addEventListener('click',()=>openKey(key));
        itemListEl.appendChild(b);
      });
    }

    function openKey(key){
      currentKey = key;
      setCrumbs([ currentCategory==='namaz'?'نماز':'تلاوت', titles[key]||key ]);
      const ayahs = surahs[key] || [];
      ayahListEl.innerHTML='';
      ayahs.forEach((text,i)=>{
        const b=document.createElement('button');
        b.className='ayah'; b.textContent=text; b.dataset.file=`audio/${key}${i+1}.mp3`;
        b.addEventListener('click',()=>safePlay(b));
        ayahListEl.appendChild(b);
      });
      buttons = Array.from(ayahListEl.querySelectorAll('button.ayah'));
      
      repeatCountInput.value = 30;
      autoAdvanceChk.checked = true;

      show('ayahs');
    }

    function buildDuaDays(){
      duaDaysListEl.innerHTML='';
      duaDays.forEach(d=>{
        const b=document.createElement('button');
        b.className='item'; b.textContent=d.label; b.dataset.day=d.key;
        b.addEventListener('click',()=>openDay(d.key, d.label));
        duaDaysListEl.appendChild(b);
      });
    }

    function duaAudioPath(dayKey, i){ return `audio/munajaat/${dayKey}${i+1}.mp3`; }

    function toggleTarjumaPanel(targetWrap) {
        const tarjumaPanel = targetWrap.querySelector('.tarjuma');
        if (!tarjumaPanel) return;
        const isAlreadyOpen = !tarjumaPanel.hidden;
        duaListEl.querySelectorAll('.dua-wrap').forEach(wrap => {
            if (wrap !== targetWrap) {
                wrap.classList.remove('open');
                const panel = wrap.querySelector('.tarjuma');
                if (panel) panel.hidden = true;
            }
        });
        if (isAlreadyOpen) {
            targetWrap.classList.remove('open');
            tarjumaPanel.hidden = true;
        } else {
            targetWrap.classList.add('open');
            tarjumaPanel.hidden = false;
            if (AUTO_SCROLL) targetWrap.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }
    
    // MODIFIED: Added reset for controls in Munajaat view
    function openDay(dayKey, dayLabel){
      currentDayKey = dayKey;
      titleEl.textContent = `مناجات مقبول – ${dayLabel}`;
      setCrumbs(['مناجات مقبول', dayLabel]);
      const items = munajaatAR[dayKey] || [];
      const urduItems = (munajaatUR[dayKey] || []);
      duaListEl.innerHTML='';
      items.forEach((text,i)=>{
        const b=document.createElement('button');
        b.className='ayah'; b.textContent=text; b.dataset.file = duaAudioPath(dayKey,i);
        
        // MODIFIED BEHAVIOR FOR JUMA DUA
        if (dayKey === 'juma') {
            const wrap = document.createElement('div');
            wrap.className = 'dua-wrap';
            // Click listener now opens the reader
            b.addEventListener('click', () => openJumaReader(i));
            wrap.appendChild(b); 
            // Translation panel is not needed here as it's in the reader
            duaListEl.appendChild(wrap);
        } else { // Original behavior for other days (if any)
            b.addEventListener('click', () => { safePlay(b); });
            duaListEl.appendChild(b);
        }

        if((munajaatPauses[dayKey]||[]).includes(i)){ b.title = "Pause after this dua"; }
      });
      buttons = Array.from(duaListEl.querySelectorAll('button.ayah'));
      
      // NEW: Reset defaults specifically for Munajaat to keep its original behavior
      repeatCountInput.value = 1;
      autoAdvanceChk.checked = false;

      show('duas');
    }

    // ---------- View Switcher ----------
    function show(view){
      categoryListEl.style.display='none'; itemListEl.style.display='none'; ayahListEl.style.display='none';
      duaDaysListEl.style.display='none'; duaListEl.style.display='none';
      controlsEl.classList.remove('active'); footerEl.classList.remove('active');
      if(view==='categories'){ categoryListEl.style.display='grid'; backWrap.style.display='none'; titleEl.textContent='الکوثر – نماز و تلاوت'; setCrumbs([]); }
      if(view==='items'){ itemListEl.style.display='grid'; backWrap.style.display='block'; }
      if(view==='ayahs'){ ayahListEl.style.display='grid'; backWrap.style.display='block'; controlsEl.classList.add('active'); footerEl.classList.add('active'); }
      if(view==='days'){ duaDaysListEl.style.display='grid'; backWrap.style.display='block'; }
      if(view==='duas'){ duaListEl.style.display='grid'; backWrap.style.display='block'; controlsEl.classList.add('active'); footerEl.classList.add('active'); }
      currentView = view;
      const currentBtn = buttons[currentIndex];
      if(currentBtn && AUTO_SCROLL) autoScroll(currentBtn);
    }

    // ---------- Events ----------
    categoryListEl.querySelectorAll('button.item').forEach(btn=>{ btn.addEventListener('click',()=>openCategory(btn.dataset.category)); });
    backBtn.addEventListener('click', ()=>{
      stopPlayback();
      duaListEl.querySelectorAll('.tarjuma').forEach(p => p.hidden = true);
      duaListEl.querySelectorAll('.dua-wrap').forEach(w => w.classList.remove('open'));
      if(currentView==='duas'){ show('days'); setCrumbs(['مناجات مقبول']); titleEl.textContent='مناجات مقبول – ایام'; return; }
      if(currentView==='days'){ show('categories'); return; }
      if(currentView==='ayahs'){ show('items'); setCrumbs([ currentCategory==='namaz'?'نماز':'تلاوت' ]); return; }
      if(currentView==='items'){ show('categories'); return; }
      show('categories');
    });

    // Init
    show('categories');
  </script>
</body>
</html>
