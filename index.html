<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>الکوثر – نماز و تلاوت</title>
  <style>
    :root{
      --bg:#0b3d2e; --accent:#a3d9c9; --accent-2:#dff3ed; --text:#fff;
      --btn:#1aa37a; --btn-dark:#108663; --card:rgba(255,255,255,.04);
      --stroke:rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Naskh Arabic","Noto Sans Arabic",sans-serif;
      background:radial-gradient(1200px 700px at 70% -10%,#146c54 0%,#0b3d2e 50%,#06231a 100%);
      color:var(--text);
      min-height:100dvh;
      padding:16px 16px calc(16px + env(safe-area-inset-bottom, 0px));
      display:grid;place-items:center;
      -webkit-text-size-adjust:100%;
    }

    /* App layout: Header | Main (scroll) | Footer (always visible) */
    .app{
      width:100%;max-width:720px;
      background:linear-gradient(180deg,var(--card),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px; box-shadow:0 10px 40px rgba(0,0,0,.25);
      backdrop-filter:blur(6px);

      display:grid; grid-template-rows:auto 1fr auto; /* header, main, footer */
      max-height:calc(100dvh - 32px);  /* stay above browser toolbars */
      overflow:hidden;                 /* keep rounded corners */
    }

    header{padding:14px 16px 8px;text-align:center;position:relative;z-index:2}
    h1{margin:0 0 6px;font-size:clamp(1.25rem, 2vw + 1rem, 1.7rem);font-weight:800}
    .crumbs{padding:0 8px 8px;color:var(--accent-2);font-size:0.95rem}

    /* Top quick-controls bar (simple, large) */
    .topbar{
      display:none; /* visible in ayahs/duas */
      align-items:center; gap:10px;
      padding:8px 16px 0;
    }
    .pill{
      display:flex; align-items:center; gap:10px;
      border:1px solid var(--stroke); border-radius:999px;
      background:rgba(255,255,255,.06); padding:10px 14px; font-weight:800;
      font-size:1rem; color:#fff;
    }
    .pill input[type="checkbox"]{width:22px;height:22px}
    .pill input[type="number"]{
      width:70px; padding:8px 6px; border-radius:10px; border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06); color:#fff; text-align:center; font-weight:800; font-size:18px;
    }

    main{
      overflow:auto; /* only main scrolls */
      padding-bottom:20px;             /* space above footer */
      scroll-behavior:smooth;
    }

    .list{padding:16px;display:grid;gap:12px;scroll-margin-block:80px}
    button.item,button.ayah,button.back{
      width:100%;border:0;border-radius:16px;padding:18px;text-align:center;cursor:pointer;
      background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
      border:1px solid var(--stroke); color:#fff;
      font-size:clamp(1.15rem, 2.6vw + 1rem, 1.7rem); font-weight:800;
      line-height:2;                   /* tall lines for therapy */
      box-shadow:0 6px 18px rgba(0,0,0,.25);

      /* never overflow on mobiles */
      white-space:normal;
      overflow-wrap:anywhere; /* allow wrap even on long segments */
      word-break:break-word;
      text-align:center;
    }
    button.ayah.playing{
      outline:4px solid var(--accent);
      box-shadow:0 0 0 4px rgba(163,217,201,.20),0 10px 26px rgba(0,0,0,.35)
    }

    /* Footer: large, bold, always visible; safe for Samsung Internet */
    .footer{
      display:flex; gap:10px; align-items:center;
      padding:10px 12px calc(10px + env(safe-area-inset-bottom, 0px));
      background:linear-gradient(180deg, rgba(11,61,46,.20), rgba(11,61,46,.80));
      border-top:1px solid var(--stroke);
      position:relative; z-index:3;
    }
    .footer button{
      flex:1; padding:14px 12px; border-radius:14px; border:0; cursor:pointer;
      font-weight:900; font-size:clamp(1.05rem, 2.2vw + .9rem, 1.3rem);
      white-space:nowrap;
    }
    .primary{background:var(--btn);color:#fff}
    .primary:active{background:var(--btn-dark)}
    .muted{background:rgba(255,255,255,.10);color:#fff;border:1px solid var(--stroke)}
    .footer .group{display:flex; align-items:center; gap:8px; flex:1.35; justify-content:center}
    .footer input[type="number"]{
      width:70px; padding:10px 8px; border-radius:10px; border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10); color:#fff; text-align:center; font-weight:800; font-size:18px;
    }
    .mini-btn{padding:10px 12px;border-radius:10px;font-weight:900}

    /* Small devices: ensure tap targets comfortable */
    @media (max-width:420px){
      .footer{gap:8px}
      .footer .group{flex:1.6}
      .pill{font-size:0.95rem}
    }
  </style>
</head>
<body>
  <div class="app">

    <!-- Header -->
    <header>
      <h1>الکوثر – نماز و تلاوت</h1>
      <div id="crumbs" class="crumbs"></div>

      <!-- Top quick controls (show in ayahs/duas) -->
      <div id="topbar" class="topbar">
        <label class="pill">
          <input id="autoAdvance" type="checkbox" />
          آٹو اگلا
        </label>
        <label class="pill">
          دہرائی:
          <input id="repeatCount" type="number" min="1" max="50" value="1" inputmode="numeric" />
          بار
        </label>
        <label class="pill">
          وقفہ:
          <input id="gapSeconds" type="number" min="0" max="10" value="1" step="1" inputmode="numeric" />
          سیکنڈ
        </label>
      </div>
    </header>

    <!-- Main (scrollable) -->
    <main id="scrollContainer">
      <!-- Categories -->
      <div id="categoryList" class="list">
        <button class="item" data-category="namaz">نماز</button>
        <button class="item" data-category="tilawat">تلاوت</button>
        <button class="item" data-category="munajaat">مناجات مقبول</button>
      </div>

      <!-- Items inside a category (Namaz items or Surahs) -->
      <div id="itemList" class="list" style="display:none"></div>

      <!-- Ayat list (for Namaz/Tilawat) -->
      <div id="ayahList" class="list" style="display:none"></div>

      <!-- Munajaat: Days list -->
      <div id="duaDaysList" class="list" style="display:none"></div>

      <!-- Munajaat: Duas for a day (Arabic only; each button plays audio) -->
      <div id="duaList" class="list" style="display:none"></div>

      <!-- Back (top) -->
      <div id="backWrap" style="display:none;padding:0 16px 16px">
        <button id="backBtn" class="back">⬅️ واپس جائیں</button>
      </div>
    </main>

    <!-- Footer (ALWAYS visible) -->
    <div id="footer" class="footer">
      <button id="backFooterBtn" class="muted">⬅️ واپس</button>
      <button id="stopBtn" class="muted">روکیں</button>

      <!-- Repeat current item N times (no auto-advance) -->
      <div class="group">
        <input id="repeatTimesFooter" type="number" min="1" max="50" value="1" inputmode="numeric" aria-label="Repeat current N">
        <button id="repeatTimesBtn" class="muted mini-btn">🔁 یہی ×</button>
      </div>

      <!-- Global Repeat (synced with top) -->
      <div class="group">
        <button id="decGlobal" class="muted mini-btn">−</button>
        <input id="repeatGlobalFooter" type="number" min="1" max="50" value="1" inputmode="numeric" aria-label="Global repeat">
        <button id="incGlobal" class="muted mini-btn">+</button>
        <span aria-hidden="true" style="font-weight:900">🔁</span>
      </div>

      <!-- Gap (seconds) -->
      <div class="group">
        <button id="decGap" class="muted mini-btn">−</button>
        <input id="gapFooter" type="number" min="0" max="10" value="1" step="1" inputmode="numeric" aria-label="Gap seconds">
        <button id="incGap" class="muted mini-btn">+</button>
        <span aria-hidden="true" style="font-weight:900">⏱</span>
      </div>

      <button id="repeatAllBtn" class="primary">سب چلائیں</button>
    </div>
  </div>

  <script>
    // ---------- Elements ----------
    const titleEl = document.querySelector('header h1');
    const crumbsEl = document.getElementById('crumbs');
    const topbarEl = document.getElementById('topbar');

    const categoryListEl = document.getElementById('categoryList');
    const itemListEl     = document.getElementById('itemList');
    const ayahListEl     = document.getElementById('ayahList');
    const duaDaysListEl  = document.getElementById('duaDaysList');
    const duaListEl      = document.getElementById('duaList');
    const scrollContainer= document.getElementById('scrollContainer');

    const backWrap = document.getElementById('backWrap');
    const backBtn  = document.getElementById('backBtn');

    const footerEl = document.getElementById('footer');
    const backFooterBtn = document.getElementById('backFooterBtn');
    const stopBtn = document.getElementById('stopBtn');
    const repeatAllBtn = document.getElementById('repeatAllBtn');

    const autoAdvanceChk = document.getElementById('autoAdvance');
    const repeatCountInput = document.getElementById('repeatCount'); // global repeat (top)
    const gapSecondsInput  = document.getElementById('gapSeconds');  // top gap

    // footer controls
    const repeatTimesFooter = document.getElementById('repeatTimesFooter'); // current ×N
    const repeatTimesBtn    = document.getElementById('repeatTimesBtn');

    const repeatGlobalFooter= document.getElementById('repeatGlobalFooter');
    const decGlobal = document.getElementById('decGlobal');
    const incGlobal = document.getElementById('incGlobal');

    const gapFooter = document.getElementById('gapFooter');
    const decGap = document.getElementById('decGap');
    const incGap = document.getElementById('incGap');

    // ---------- State ----------
    let currentAudio = null, currentIndex = -1, remainingRepeats = 1, playingAll = false;
    let buttons = [];
    let currentView = 'categories'; // categories | items | ayahs | days | duas
    let currentCategory = null;     // 'namaz' | 'tilawat' | 'munajaat'
    let currentKey = null;          // item key (for namaz/tilawat)
    let currentDayKey = null;       // day key (for munajaat)
    let pendingTimer = null;        // for gap delays

    // ---------- Data ----------
    const namazKeys = ["takbeer","sanaa","tauz","tasmia","fatiha","ruku","tasmeeh","tahmeed","sajda","attahiyat","darood_ibrahimi","dua_rabbana","salaam"];
    const tilawatKeys = ["feel","quraish","kawthar","kafiroon","ikhlas","falaq","naas","ayatul-kursi"];

    const titles = {
      takbeer:"تکبیرِ تحریمہ", sanaa:"ثنا", tauz:"تعوذ", tasmia:"تسمیہ", fatiha:"سورہ فاتحہ",
      ruku:"رکوع", tasmeeh:"تسمیع", tahmeed:"تحمید", sajda:"سجدہ",
      attahiyat:"التحیات", darood_ibrahimi:"درودِ ابراہیمی", dua_rabbana:"دعا (رَبَّنَا)", salaam:"سلام",
      feel:"سورۃ الفیل", quraish:"سورۃ قریش", kawthar:"سورۃ الکوثر", kafiroon:"سورۃ الکافرون",
      ikhlas:"سورۃ الاخلاص", falaq:"سورۃ الفلق", naas:"سورۃ الناس", "ayatul-kursi":"آیت الکرسی"
    };

    const surahs = {
      takbeer:["اللهُ اکبر"],
      sanaa:["مکمل ثنا","سُبْحَانَکَ اللّٰهُمَّ وَبِحَمْدِکَ","وَتَبَارَکَ اسْمُکَ","وَتَعَالیٰ جَدُّکَ","وَلَا اِلٰهَ غَيْرُکْ"],
      tauz:["اَعُوْذُ بِاللّٰہِ مِنَ الشَّیْطٰنِ الرَّجِیْم"],
      tasmia:["بِسْمِ اللّٰہِ الرَّحْمٰنِ الرَّحِیْم"],
      fatiha:["مکمل سورہ فاتحہ","اَلْحَمْدُ لِلّٰهِ رَبِّ الْعٰلَمِيْنَ","الرَّحْمٰنِ الرَّحِيْمِ","مٰلِكِ يَوْمِ الدِّيْنِ","اِيَّاكَ نَعْبُدُ وَاِيَّاكَ نَسْتَعِيْنُ","اِهْدِنَا الصِّرَاطَ الْمُسْتَقِيْمَ","صِرَاطَ الَّذِيْنَ اَنْعَمْتَ عَلَيْهِمْ ەۙ غَيْرِ الْمَغْضُوْبِ عَلَيْهِمْ وَلَا الضَّاۤلِّيْنَ"],
      ruku:["سُبْحَانَ رَبِّيَ الْعَظِيْمِ"],
      tasmeeh:["سَمِعَ اللّٰهُ لِمَنْ حَمِدَهٗ"],
      tahmeed:["رَبَّنَا لَكَ الْحَمْدُ"],
      sajda:["سُبْحَانَ رَبِّيَ الْأَعْلٰى"],
      attahiyat:["مکمل التحیات","اَلتَّحِيَّاتُ لِلّٰهِ وَالصَّلَوٰتُ وَالطَّيِّبَاتُ","اَلسَّلَامُ عَلَيْكَ اَيُّهَا النَّبِيُّ","وَرَحْمَةُ اللّٰهِ وَبَرَكَاتُهٗ","اَلسَّلَامُ عَلَيْنَا وَعَلٰی عِبَادِ اللّٰهِ الصَّالِحِيْن","اَشْهَدُ اَنْ لَّا اِلٰهَ اِلَّا اللّٰهُ","وَاَشْهَدُ اَنَّ مُحَمَّدًا عَبْدُهٗ وَرَسُوْلُهٗ"],
      darood_ibrahimi:["اَللّٰهُمَّ صَلِّ عَلٰی مُحَمَّدٍ وَّعَلٰى اٰلِ مُحَمَّدٍ","كَمَا صَلَّيْتَ عَلٰى اِبْرَاهِيْمَ وَعَلٰى اٰلِ اِبْرَاهِيْمَ","اِنَّكَ حَمِيْدٌ مَّجِيْدٌ","اَللّٰهُمَّ بَارِكْ عَلٰی مُحَمَّدٍ وَّعَلٰى اٰلِ مُحَمَّدٍ","كَمَا بَارَكْتَ عَلٰى اِبْرَاهِيْمَ وَعَلٰى اٰلِ اِبْرَاهِيْمَ","اِنَّكَ حَمِيْدٌ مَّجِيْدٌ"],
      dua_rabbana:["رَبَّنَا اٰتِنَا فِي الدُّنْيَا حَسَنَةً","وَّفِي الْاٰخِرَةِ حَسَنَةً","وَّقِنَا عَذَابَ النَّارِ"],
      salaam:["اَلسَّلَامُ عَلَيْكُمْ وَرَحْمَةُ اللّٰه - اَلسَّلَامُ عَلَيْكُمْ وَرَحْمَةُ اللّٰه"],

      feel:["مکمل سورہ فیل","أَلَمْ تَرَ كَيْفَ فَعَلَ رَبُّكَ بِأَصْحَابِ الْفِيلِ","أَلَمْ يَجْعَلْ كَيْدَهُمْ فِي تَضْلِيلٍ","وَأَرْسَلَ عَلَيْهِمْ طَيْرًا أَبَابِيلَ","تَرْمِيهِمْ بِحِجَارَةٍ مِّن سِجِّيلٍ","فَجَعَلَهُمْ كَعَصْفٍ مَّأْكُولٍ"],
      quraish:["لِإِيلَافِ قُرَيْشٍ","إِيلَافِهِمْ رِحْلَةَ الشِّتَاءِ وَالصَّيْفِ","فَلْيَعْبُدُوا رَبَّ هَذَا الْبَيْتِ","الَّذِي أَطْعَمَهُم مِّن جُوعٍ وَآمَنَهُم مِّنْ خَوْفٍ"],
      kawthar:["إِنَّا أَعْطَيْنَاكَ الْكَوْثَرَ","فَصَلِّ لِرَبِّكَ وَانْحَرْ","إِنَّ شَانِئَكَ هُوَ الْأَبْتَرُ"],
      kafiroon:["قُلْ يَا أَيُّهَا الْكَافِرُونَ","لَا أَعْبُدُ مَا تَعْبُدُونَ","وَلَا أَنتُمْ عَابِدُونَ مَا أَعْبُدُ","وَلَا أَنَا عَابِدٌ مَّا عَبَدتُّمْ","وَلَا أَنتُمْ عَابِدُونَ مَا أَعْبُدُ","لَكُمْ دِينُكُمْ وَلِيَ دِينِ"],
      ikhlas:["قُلْ هُوَ اللَّهُ أَحَدٌ","اللَّّهُ الصَّمَدُ","لَمْ يَلِدْ وَلَمْ يُولَدْ","وَلَمْ يَكُن لَّهُ كُفُوًا أَحَدٌ"],
      falaq:["قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ","مِن شَرِّ مَا خَلَقِ","وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ","وَمِن شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ","وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ"],
      naas:["قُلْ أَعُوذُ بِرَبِّ النَّاسِ","مَلِكِ النَّاسِ","إِلَٰهِ النَّاسِ","مِن شَرِّ الْوَسْوَاسِ الْخَنَّاسِ","الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ","مِنَ الْجِنَّةِ وَالنَّاسِ"],
      "ayatul-kursi":[
        "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ","لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ","لَهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ",
        "مَن ذَا الَّذِي يَشْفَعُ عِندَهُ إِلَّا بِإِذْنِهِ","يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ","وَلَا يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلَّا بِمَا شَاءَ",
        "وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضِ","وَلَا يَئُودُهُ حِفْظُهُمَا","وَهُوَ الْعَلِيُّ الْعَظِيمُ"
      ]
    };

    // Munajaat: only Juma shown here (you can add more day keys/content later)
    const duaDays = [{key:'juma', label:'جمعہ دعا'}];

    const munajaatAR = {
      juma: [
        "نَحْمَدُكَ يَا خَيْرَ مَأْمُوْلٍ","  وَاَكْرَمَ مَسْئُوْلٍ","عَليٰ مَا عَلَّمْتَنَا مِنَ الْمُنَاجَاةِ الْمَقْبُوْلِ","مِنْ قُرُبٰتٍ عِنْدَاللّٰہِ وَصَلَوٰتِ الرَّسُوْلِ","فَصَلِّ عَلَيْہِ مَااخْتَلَفَ الدَّبُوْرُ وَالْقَبُوْلُ","وَانْشَعَبَتِ الْفُرُوْعُ مِنَ الْاُصُوْلِ","ثُمَّ نَسْئَلُكَ بِمَا سَنَقُوْلُ","وَمِنَّا السُّؤَالُ وَمِنْكَ الْقُبُوْلُ","يَارَبِّ يَارَبِّ يَارَبِّ","اَللّٰہُمَّ يَاكَبِيْرُ يَاسَمِيْعُ يَا بَصِيْرُ ","يَامَنْ لَّاشَرِيْكَ لَہٗ وَلَا وَزِيْرَلَہٗ","وَيَاخَالِقَ   الشَّمْسِ وَالْقَمَرِ الْمُنِيْرِ "," وَيَاعِصْمَةَ الْبَآىِٔسِ الْخَآىِٔفِ الْمُسْتَجِيْرِ"," وَيَارَازِقَ الطِّفْلِ الصَّغِيْرِ","وَيَاجَابِرَ الْعَظْمِ الْكَسِيْرِ","اَدْعُوْكَ دُعَآءَ الْبَآىِٔسِ الْفَقِيْرِ كَدُعَآءِ الْمُضْطَرِّ الضَّرِيْرِ","اَسْأَلُكَ بِمَعَاقِدِ الْعِزِّمِنْ عَرْشِكَ وَبِمَفَاتِيْحِ الرَّحْمَةِ مِنْ كِتَابِكَ","وَبِالْاَسْمَآءِ الثَّمَانِيَةِ الْمَكْتُوْبَةِ عَليٰ قَرْنِ الشَّمْسِ اَنْ تَجْعَلَ الْقُرْاٰنَ رَبِيْعَ قَلْبِيْ وَجِلَآءَ حُزْنِيْ",
        "رَبَّناۤ اٰتِنَا فِي الدُّنْيَا ﴿ كَذَاوَكَذَا﴾ ",
        "يَا مُوْنِسَ كُلِّ وَحِيْدٍ"," وَّيَاصَاحِبَ كُلِّ فَرِيْدٍ","وَّيَا قَرِيْبًا غَيْرَ بَعِيْدٍ وَّيَا شَاہِدًا غَيْرَ غَآىِٔبٍ"," وَّيَاغَالِبًا غَيْرَ مَغْلُوْبٍ، يَّاحَيُّ يَاقَيُّوْمُ","يَاذَالْجَلَالِ وَالْاِكْرَامِ","يَانُوْرَ السَّمٰوٰتِ وَالْاَرْضِ، وَيَازَيْنَ السَّمٰوٰتِ وَالْاَرْضِ","يَاجَبَّارَ السَّمٰوٰتِ وَالْاَرْضِ","يَا عِمَادَ السَّمٰوٰتِ وَالْاَرْضِ"," يَابَدِيْعَ السَّمٰوٰتِ وَالْاَرْضِ"," وَيَاقَيَّامَ السَّمٰوٰتِ وَالْاَرْضِ","يَاذَالْجَلَالِ وَالْاِكْرَامِ يَاصَرِيْخَ الْمُسْتَصْرِخِيْنَ وَمُنْتَہَي الْعَآىِٔذِيْنَ"," وَالْمُفَرِّجُ عَنِ الْمَكْرُوْبِيْنَ"," وَالْمُرَوِِّحُ عَنِ الْمَغْمُوْمِيْنَ، وَمُجِيْبَ دُعَآءِ الْمُضْطَرِّيْنَ","وَيَاكَاشِفَ الْمَكْرُوْبِ"," يَاۤاِلٰہَ الْعٰلَمِيْنَ وَ يَاۤاَرْحَمَ الرّٰاحِمِيْنَ مَنْزُوْلٌۭ بِكَ كُلُّ حَاجَۃٍ",
        "اَللّٰہُمَّ اِنَّكَ خَلَّا قٌ عَظِیْمٌ"," اِنَّكَ سَمِیْعٌ عَلِیْمٌ ","اِنَّكَ غَفُوْرٌ رَّحِیْمٌ"," اِنَّكَ رَبُّ الْعَرْشِ الْعَظِیْمِ","اَللّٰہُمَّ اِنَّكَ الْبَرُّ الْجَوَّادُ الْكَرِیْمُ ","اغْفِرْلِیْ وَارْحَمْنِیْ وَعَافِنِیْ"," وَارْزُقْنِیْ وَاسْتُرْنِیْ  وَاجْبُرْنِیْ"," وَارْفَعْنِیْ  وَاہْدِنِیْ وَلَا تُضِلَّنِیْ"," وَاَدْخِلْنِیَ الْجَنَّۃَ بِرَحْمَتِكَ یَاۤاَرْحَمَ الرّٰحِمِیْنَ","اِلَیْكَ رَبِّ فَحَبِّبْنِیْ"," وَفِیْ نَفْسِیْ لَكَ فَذَلِّلْنِیْ ","وَفِیْۤ اَعْیُنِ النَّاسِ فَعَظِّمْنِیْ ","وَمِنْ سَیِّءِ الْاَخْلَاقِ  فَجَنِّبْنِیْ"," اَللّٰہُمَّ اِنَّكَ سَاَلْتَنَا مِنْ اَنْفُسِنَا مَالَا نَمْلِكُہٗۤ اِلَّابِكَ ","فَاَعْطِنَا مِنْہَامَا یُرْضِیْكَ عَنَّا",
        "اَللّٰہُمَّ اِنِّیْۤ اَسْاَلُكَ اِیْمَانًا دَآىِٔمًا","وَّاَسْاَلُكَ قَلْبًا خَاشِعًا","وَّاَسْاَلُكَ یَقِیْنًا صَادِقًا","وَّاَسْاَلُكَ دِیْنًا قَیِّمًا","وَّاَسْاَلُكَ الْعَافِیَۃَ مِنْ كُلِّ بَلِیَّۃٍ","وَاَسْاَلُكَ دَوَامَ الْعَافِیَۃِ","وَاَسْاَلُكَ الشُّكْرَعَلَی الْعَافِیَۃِ","وَاَسْاَلُكَ الْغِنٰی عَنِ النَّاسِ","اَللّٰہُمَّ اِنِّیْۤ اَسْتَغْفِرُكَ لِمَا تُبْتُ اِلَیْكَ مِنْہُ ثُمَّ عُدْتُّ فِیْہِ","وَاَسْتَغْفِرُكَ لِمَاۤاَعْطَیْتُكَ مِنْ نَّفْسِیْ ثُمَّ لَمْ اُوْفِ لَكَ بِہٖ","وَاَسْتَغْفِرُكَ لِلنِّعَمِ الَّتِیْ تَقَوَّیْتُ بِہَا عَلیٰ مَعْصِیَتِكَ","وَاَسْتَغْفِرُكَ لِکُلِّ خَیْرٍاَرَدْتُّ بِہٖ وَجْہَكَ  فَخَالَطَنِیْ فِیْہِ مَالَیْسَ لَكَ","اَللّٰہُمَّ لَا تُخْزِنِیْ فَاِنَّكَ بِیْ عَالِمٌ","وَّلَا تُعَذِّبْنِیْ فَاِنَّكَ عَلَیَّ قَادِرٌ",
        "اَللّٰہُمَّ رَبَّ السَّمٰوَاتِ السَّبْعِ","وَرَبَّ الْعَرْشِ الْعَظِیْمِ","اَللّٰہُمَّ اكْفِنِیْ كُلَّ مُہِمٍّ مِّنْ حَیْثُ شِئْتَ  وَمِنْ اَیْنَ شِئْتَ","حَسْبِیَ اللہُ لِدِیْنِیْ","حَسْبِیَ اللہُ لِدُنْیَایَ","حَسْبِیَ اللہُ لِمَاۤ اَہَمَّنِیْ","حَسْبِیَ اللہُ لِمَنْۭ بَغٰی عَلَیَّ","حَسْبِیَ اللہُ لِمَنْ حَسَدَنِیْ","حَسْبِیَ اللہُ لِمَنْ كَادَنِیْ بِسُوٓءٍ","حَسْبِیَ اللہُ عِنْدَ الْمَوْتِ","حَسْبِیَ اللہُ عِنْدَ الْمَسْئَلَۃِ فِی الْقَبْرِ","حَسْبِیَ اللہُ عِنْدَ الْمِیْزَانِ","حَسْبِیَ اللہُ عِنْدَ الصِّرَاطِ","حَسْبِیَ اللہُ لَااِلٰہَ اِلَّاہُوَ","عَلَیْہِ تَوَكَّلْتُ","وَہُوَ رَبُّ الْعَرْشِ الْعَظِیْمِ",
        "اَللّٰہُمَّ اِنِّیْ اَسْاَلُكَ ثَوَابَ الشَّاكِرِیْنَ","وَنُزُلَ الْمُقَرَّبِیْنَ","وَمُرَافَقَۃَ النَّبِیِّیْنَ","وَیَقِیْنَ الصِّدِّیْقِیْنَ","وَذِلَّۃَ الْمُتَّقِیْنَ","وَاِخْبَاتَ الْمُوْقِنِیْنَ","حَتّٰی تَوَفَّانِیْ عَلیٰ ذَالِكَ","یَاۤ اَرْحَمَ الرَّاحِمِیْنَ",
        "اَللّٰہُمَّ اِنِّیْ اَسْاَلُكَ بِنِعْمَتِكَ السَّابِقَۃِ عَلَیَّ","وَبَلَاۤىِٔكَ الْحَسَنِ الَّذِیْ ابْتَلَیْتَنِیْ بِہٖ","وَفَضْلِكَ الَّذِیْ فَضَّلْتَ عَلَیَّ","اَنْ تُدْخِلَنِیَ الْجَنَّۃَ بِمَنِّكَ  وَفَضْلِكَ وَرَحْمَتِكَ",
        "اَللّٰہُمَّ اِنِّی اَسْاَلُكَ اِیْمَانًا دَآىِٔمًا","وَّہُدًی قَیِّمًا","وَّعِلْمًا نَّافِعًا",
        "اَللّٰہُمَّ لَا تَجْعَلْ لِفَاجِرٍ","عِنْدِیْ نِعْمَۃً اُكَافِیْہِ بِہَا","فِی الدُّنْیَا وَ الْاٰخِرَۃِ",
        "اَللّٰہُمَّ اغْفِرْلِیْ ذَنْۢبِیْ","وَوَسِّعْ لِیْ خُلُقِیْ","وَطَیِّبْ لِیْ كَسْبِیْ","وَقَنِّعْنِیْ بِمَا رَزَقْتَنِیْ","وَلَا تُذْہِبْ طَلَبِیْ اِليٰ شَیْءٍ صَرَّفْتَہٗ عَنِّیْ",
        "اَللّٰہُمَّ اِنِّیْ اَسْتَجِیْرُكَ مِنْ جَمِیْعِ كُلِّ شَیْءٍ خَلَقْتَ","وَاَحْتَرِسُ بِكَ مِنْہُنَّ","وَاجْعَلْ لِّیْ عِنْدَكَ وَلِیْجَۃً","وَّاجْعَلْ لِّیْ عِنْدَكَ زُلْفٰی","وَحُسْنَ مَاٰبٍ","وَّاجْعَلْنِیْ مِمَّنْ یَّخَافُ","مَقَامَكَ وَ وَعِیْدَكَ","وَیَرْجُوْا لِقَآئَكَ","وَاجْعَلْنِیْ مِمَّنْ یَّتُوْبُ اِلَیْكَ تَوْبَۃً نَّصُوْحًا","وَّاَسْاَلُكَ عَمَلاً مُّتَقَبَّلًا","وَّعِلْمًا نَّجِیْحًا  وَّسَعْیًا مَّشْكُوْرًا","وَّتِجَارَۃً لَّنْ تَبُوْرَ",
        "اَللّٰہُمَّ اِنِّیْ اَسْاَلُكَ فِكَاكَ رَقَبَتِیْ مِنَ النَّارِ",
        "اَللّٰہُمَّ اَعِنِّیْ عَلیٰ غَمَرَاتِ الْمَوْتِ وَسَكَرَاتِ الْمَوْتِ",
        "اَللّٰہُمَّ اغْفِرْلِیْ وَارْحَمْنِیْ وَاَلْحِقْنِیْ بِالرَّفِیْقِ الْاَعْلیٰ",
        "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنْ اَنْ اُشْرِكَ بِكَ شَیْئًا وَّاَنَا اَعْلَمُ",
        "وَاَسْتَغْفِرُكَ لِمَالَاۤ اَعْلَمُ بِہٖ",
        "وَاَعُوْذُبِكَ اَنْ یَّدْعُوَ عَلَیَّ رَحِمٌ قَطَعْتُہَا",
        "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنْ شَرِّمَنْ یَّمْشِیْ عَلیٰ بَطْنِہٖ",
        "وَمِنْ شَرِّ مَنْ یَّمْشِیْ عَلیٰ رِجْلَیْنِ",
        "وَمِنْ شَرِّ مَنْ یَّمْشِیْ عَلیٰۤ اَرْبَعٍ",
        "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنِ امْرَاَۃٍ تُشَیِّبُنِیْ قَبْلَ الْمَشِیْبِ",
        "وَاَعُوْذُبِكَ مِنْ وَّلَدٍ یَّكُونُ عَلَیَّ وَبَالًا",
        "وَّاَعُوْذُبِكَ مِنْ مَّالٍ یَّكُونُ عَلَیَّ عَذَابًا",
        "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنَ الشَّكِّ فِی الْحَقِّ بَعْدَ الْیَقِیْنِ",
        "وَاَعُوْذُبِكَ مِنَ الشَّیْطٰنِ الرَّجِیْمِ",
        "وَاَعُوْذُبِكَ مِنْ شَرِّ یَوْمِ الدِّیْنِ",
        "اَللّٰہُمَّ اِنِّیْۤ اَعُوْذُبِكَ مِنْ مَّوْتِ الْفُجَآءَۃِ",
        "وَمِنْ لَّدْغِ الْحَیَّۃِ وَمِنَ السَّبُعِ",
        "وَمِنَ الْغَرَقِ وَمِنَ الْحَرَقِ",
        "وَمِنْ اَنْ اَخِرَّعَلَیٰ شَیْءٍ",
        "وَّمِنَ الْقَتْلِ عِنْدَ فِرَارِ الزَّحْفِ",
        "وَتَقَبَّلْ ھٰذِہِ الدَّعْوَاتِ",
        "فِیْ حَقِّ مُحَمَّد اَشْرَفْ عَلِیْ",
        "وَ كاكا صاحب",
        "وَعَبْدِ الْوَاسِعْ وَمُحَمَّدْ مُصْطَفیٰ",
        "وَمُحَمَّدْ عَلِیْ وَمُحَمَّدْ شفیع",
        "وَعَبْدِالْمَاجِدْ",
        "وَمَوْلَانَا اشرف سُلَیْمَانِیْ",
        "ومولانا زکریا",
        "وَصوفی مُحَمَّدْ اِقْبَال مدنی",
        "وسَیَّدعَلِیْ شاہ",
        "وَسَیَّد تَسْنِیْمُ الْحَقْ",
        "وسَیَّد تَنْظِیْمُ الْحَقْ رَحْمَۃُاللہِ تَعَالٰی عَلَیْہِم",
        "وَجَمِیْعِ الْمُتَعَلِّقِیْن وَفِیْ حَقِّ اَبَاىِٔہِمْ وَ اُمَّہَاتِہِمْ",
        "وَجَمِیْعِ الْمُوْمِنِیْنَ وَ الْمُوْمِنَاتِ",
        "وَصَلَّی اللہُ تَعَالیٰ عَلیٰ سَیِّدِ الْکَآىِٔنَاتِ وَ اَکْرَمِ الْمَخْلُوْقَاتِ",
        "صَلٰوۃً تَسْبِقُ الْغَایَاتِ"
      ]
    };

    // Pause points after certain indices (0-based). Example: pause after 18
    const munajaatPauses = { juma: [18] };

    // ---------- Helpers ----------
    const clampNum = (v,min,max)=> Math.max(min, Math.min(max, Number(v)||min));

    function setCrumbs(parts){ crumbsEl.textContent = parts.filter(Boolean).join(" › "); }

    function clearTimer(){ if(pendingTimer){ clearTimeout(pendingTimer); pendingTimer=null; } }

    function clearPlayingStyles(){ buttons.forEach(b=>b.classList.remove('playing')); }

    function isInView(container, el){
      const cr = container.getBoundingClientRect();
      const er = el.getBoundingClientRect();
      return er.top >= cr.top + 20 && er.bottom <= cr.bottom - 20;
    }

    function autoScrollIfNeeded(el){
      // only scroll if item not fully visible (so it won't fight manual scrolling)
      if(!isInView(scrollContainer, el)){
        try{ el.scrollIntoView({behavior:'smooth', block:'center', inline:'nearest'}); }catch(e){}
      }
    }

    function stopPlayback(){
      playingAll=false;
      clearTimer();
      if(currentAudio){ currentAudio.pause(); currentAudio=null; }
      clearPlayingStyles();
      currentIndex=-1;
    }

    function shouldPauseAfter(ix){
      if(currentView!=='duas' || !currentDayKey) return false;
      return (munajaatPauses[currentDayKey] || []).includes(ix);
    }

    function playIndex(ix){
      const btn = buttons[ix]; if(!btn) return;

      const pauseThisItem = shouldPauseAfter(ix);

      // prepare
      stopPlayback(); // also clears timers
      clearPlayingStyles();
      btn.classList.add('playing'); currentIndex = ix;
      autoScrollIfNeeded(btn);

      const audio = new Audio(btn.dataset.file);
      currentAudio = audio;
      audio.playbackRate = 1; // fixed rate for clarity; change if needed

      // set repeats: pause items always once; otherwise per global repeat
      remainingRepeats = pauseThisItem ? 1 : clampNum(repeatCountInput.value,1,50);

      const gapMs = clampNum(gapSecondsInput.value,0,10) * 1000;

      audio.addEventListener('ended', ()=>{
        remainingRepeats--;
        if(remainingRepeats > 0){
          clearTimer();
          pendingTimer = setTimeout(()=>{ if(currentAudio===audio){ audio.currentTime=0; audio.play(); } }, gapMs);
          return;
        }
        if(pauseThisItem){
          playingAll = false;
          return; // stay highlighted; wait for manual
        }
        if(playingAll || autoAdvanceChk.checked){
          if(ix + 1 < buttons.length){
            clearTimer();
            pendingTimer = setTimeout(()=>{ playIndex(ix + 1); }, gapMs);
          } else {
            playingAll = false; clearPlayingStyles();
          }
        } else {
          clearPlayingStyles();
        }
      });

      audio.play().catch(()=>{ /* autoplay guard */ });
    }

    function playCurrentNTimes(n){
      if(currentIndex < 0){
        if(buttons.length === 0) return;
        currentIndex = 0;
      }
      const ix = currentIndex;
      playingAll = false;
      const prev = repeatCountInput.value;
      repeatCountInput.value = String(clampNum(n,1,50));
      playIndex(ix);
      repeatCountInput.value = prev;
    }

    // ---------- Build Lists ----------
    function openCategory(cat){
      currentCategory = cat;
      if(cat==='namaz'){ titleEl.textContent='نماز – اذکار و قراءت'; setCrumbs(['نماز']); buildItems(namazKeys); show('items'); }
      else if(cat==='tilawat'){ titleEl.textContent='تلاوت – سورتیں و آیات'; setCrumbs(['تلاوت']); buildItems(tilawatKeys); show('items'); }
      else if(cat==='munajaat'){ titleEl.textContent='مناجات مقبول – ایام'; setCrumbs(['مناجات مقبول']); buildDuaDays(); show('days'); }
    }

    function buildItems(keys){
      itemListEl.innerHTML='';
      keys.forEach(key=>{
        const b=document.createElement('button');
        b.className='item';
        b.textContent=titles[key]||key;
        b.dataset.key=key;
        b.addEventListener('click',()=>openKey(key));
        itemListEl.appendChild(b);
      });
    }

    function openKey(key){
      currentKey = key;
      setCrumbs([ currentCategory==='namaz'?'نماز':'تلاوت', titles[key]||key ]);
      const ayahs = surahs[key] || [];
      ayahListEl.innerHTML='';
      ayahs.forEach((text,i)=>{
        const b=document.createElement('button');
        b.className='ayah';
        b.textContent=text;
        b.dataset.file=`audio/${key}${i+1}.mp3`;
        b.addEventListener('click',()=>{ playingAll=false; playIndex(i); });
        ayahListEl.appendChild(b);
      });
      buttons = Array.from(ayahListEl.querySelectorAll('button.ayah'));
      show('ayahs');
    }

    function buildDuaDays(){
      duaDaysListEl.innerHTML='';
      duaDays.forEach(d=>{
        const b=document.createElement('button');
        b.className='item';
        b.textContent=d.label;
        b.dataset.day=d.key;
        b.addEventListener('click',()=>openDay(d.key, d.label));
        duaDaysListEl.appendChild(b);
      });
    }

    function duaAudioPath(dayKey, i){ return `audio/munajaat/${dayKey}${i+1}.mp3`; }

    function openDay(dayKey, dayLabel){
      currentDayKey = dayKey;
      titleEl.textContent = `مناجات مقبول – ${dayLabel}`;
      setCrumbs(['مناجات مقبول', dayLabel]);

      const items = munajaatAR[dayKey] || [];
      duaListEl.innerHTML='';
      items.forEach((text,i)=>{
        const b=document.createElement('button');
        b.className='ayah';
        b.textContent=text;
        b.dataset.file = duaAudioPath(dayKey,i);
        b.addEventListener('click',()=>{ playingAll=false; playIndex(buttons.indexOf(b)); });
        duaListEl.appendChild(b);
      });

      buttons = Array.from(duaListEl.querySelectorAll('button.ayah'));
      show('duas');
    }

    // ---------- View Switcher ----------
    function show(view){
      categoryListEl.style.display='none';
      itemListEl.style.display='none';
      ayahListEl.style.display='none';
      duaDaysListEl.style.display='none';
      duaListEl.style.display='none';

      // top quick-controls shown only in ayahs/duas
      topbarEl.style.display = (view==='ayahs' || view==='duas') ? 'flex' : 'none';
      backWrap.style.display = (view==='categories') ? 'none' : 'block';

      if(view==='categories'){
        categoryListEl.style.display='grid';
        titleEl.textContent='الکوثر – نماز و تلاوت'; setCrumbs([]);
      }
      if(view==='items'){ itemListEl.style.display='grid'; }
      if(view==='ayahs'){ ayahListEl.style.display='grid'; }
      if(view==='days'){ duaDaysListEl.style.display='grid'; }
      if(view==='duas'){ duaListEl.style.display='grid'; }
      currentView = view;

      const currentBtn = buttons[currentIndex];
      if(currentBtn) autoScrollIfNeeded(currentBtn);
    }

    // ---------- Events ----------
    categoryListEl.querySelectorAll('button.item').forEach(btn=>{
      btn.addEventListener('click',()=>openCategory(btn.dataset.category));
    });

    backBtn.addEventListener('click', ()=>{
      stopPlayback();
      if(currentView==='duas'){ show('days'); setCrumbs(['مناجات مقبول']); titleEl.textContent='مناجات مقبول – ایام'; return; }
      if(currentView==='days'){ show('categories'); return; }
      if(currentView==='ayahs'){ show('items'); setCrumbs([ currentCategory==='namaz'?'نماز':'تلاوت' ]); return; }
      if(currentView==='items'){ show('categories'); return; }
      show('categories');
    });
    backFooterBtn.addEventListener('click', ()=> backBtn.click());

    stopBtn.addEventListener('click', stopPlayback);
    repeatAllBtn.addEventListener('click', ()=>{ playingAll=true; playIndex(0); });

    // Repeat current N (footer)
    repeatTimesBtn.addEventListener('click', ()=>{
      playCurrentNTimes(repeatTimesFooter.value);
    });

    // Sync Global Repeat (top <-> footer)
    repeatGlobalFooter.value = repeatCountInput.value;
    repeatCountInput.addEventListener('input', ()=>{
      const v = clampNum(repeatCountInput.value,1,50);
      repeatCountInput.value = v; repeatGlobalFooter.value = v;
    });
    repeatGlobalFooter.addEventListener('input', ()=>{
      const v = clampNum(repeatGlobalFooter.value,1,50);
      repeatGlobalFooter.value = v; repeatCountInput.value = v;
    });
    decGlobal.addEventListener('click', ()=>{
      const v = clampNum(repeatGlobalFooter.value,1,50) - 1;
      repeatGlobalFooter.value = v; repeatCountInput.value = v;
    });
    incGlobal.addEventListener('click', ()=>{
      const v = clampNum(repeatGlobalFooter.value,1,50) + 1;
      repeatGlobalFooter.value = v; repeatCountInput.value = v;
    });

    // Gap seconds (top <-> footer)
    gapFooter.value = gapSecondsInput.value;
    gapSecondsInput.addEventListener('input', ()=>{
      const v = clampNum(gapSecondsInput.value,0,10);
      gapSecondsInput.value = v; gapFooter.value = v;
    });
    gapFooter.addEventListener('input', ()=>{
      const v = clampNum(gapFooter.value,0,10);
      gapFooter.value = v; gapSecondsInput.value = v;
    });
    decGap.addEventListener('click', ()=>{
      const v = clampNum(gapFooter.value,0,10) - 1;
      gapFooter.value = v; gapSecondsInput.value = v;
    });
    incGap.addEventListener('click', ()=>{
      const v = clampNum(gapFooter.value,0,10) + 1;
      gapFooter.value = v; gapSecondsInput.value = v;
    });

    // Init
    autoAdvanceChk.checked = false;      // default is Manual
    repeatCountInput.value = "1";        // default repeat = 1
    repeatGlobalFooter.value = "1";
    gapSecondsInput.value = "1";         // default 1s gap
    gapFooter.value = "1";

    show('categories');
  </script>
</body>
</html>
